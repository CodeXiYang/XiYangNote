# MySQL+æ•°æ®è¿ç§»

> è¯¾ç¨‹åç§°: [ä»é›¶ç©è½¬MySQL+æ•°æ®è¿ç§»(14)](https://www.it666.com/my/course/193)
>
> è¯¾ç¨‹æ¦‚è¿°: MySQLåŸºç¡€éƒ¨åˆ†ä»¥åŠé«˜çº§
>
> è®²è¿°äºº: æå—æ±Ÿ

## ç¬¬ 1 ç« : MySQLå¼€ç¯‡ ğŸš©

### 1.1 ä»€ä¹ˆæ˜¯æ•°æ®åº“?

- æ•°æ®åº“å°±æ˜¯å­˜å‚¨æ•°æ®çš„ä»“åº“
- æ•°æ®åº“å’ŒExcelå¾ˆåƒ, Excelæœ¬è´¨æ˜¯ä¸€ä¸ªæ–‡ä»¶ï¼Œ æ•°æ®åº“æœ¬è´¨ä¸Šä¹Ÿæ˜¯ä¸€ä¸ªæ–‡ä»¶ï¼Œ
- æ•°æ®åº“å’ŒExcelå¾ˆåƒ, Excelæ–‡ä»¶ä¸­å¯ä»¥æœ‰å¾ˆå¤šçš„è¡¨, ä¸€ä¸ªæ•°æ®åº“ä¸­ä¹Ÿæœ‰å¾ˆå¤šçš„è¡¨
- æ•°æ®åº“å’ŒExcelå¾ˆåƒ, Excelæ–‡ä»¶çš„æ¯å¼ è¡¨å°±æ˜¯ç”¨æ¥å­˜å‚¨æ•°æ®çš„, æ•°æ®åº“æ–‡ä»¶çš„æ¯å¼ è¡¨ä¹Ÿæ˜¯ç”¨æ¥å­˜å‚¨æ•°æ®çš„
- æ‰€ä»¥å­¦ä¹ æ•°æ®åº“å’Œå­¦ä¹ Excelå·®ä¸å¤š,
  å°±æ˜¯å­¦ä¹ å¦‚ä½•æ–°å»ºæ•°æ®åº“æ–‡ä»¶,å¦‚ä½•åœ¨æ•°æ®åº“ä¸­æ–°å»ºè¡¨,å¦‚ä½•å¾€è¡¨ä¸­å­˜å‚¨æ•°æ®å’Œæ“ä½œè¡¨ä¸­çš„æ•°æ®

### 1.2 ä»€ä¹ˆæ˜¯MySQL?

-  MySQLæ˜¯ç”±ç‘å…¸AB å…¬å¸å¼€å‘"å…³ç³»å‹"æ•°æ®ï¼Œç›®å‰å±äº Oracle æ——ä¸‹äº§å“
-  ç”±äºMySQLæ˜¯å¼€æºå…è´¹çš„, æ‰€ä»¥ç°åœ¨æ˜¯å¸‚é¢ä¸Šæœ€å—æ¬¢è¿çš„æ•°æ®åº“ä¹‹ä¸€

### 1.3 ä»€ä¹ˆæ˜¯å…³ç³»å‹æ•°æ®åº“?

**æ•°æ®åº“èŒèŠ½é˜¶æ®µ:**

- æœ€åˆç¨‹åºå‘˜ä»¬æŠŠç£ç›˜ä¸Šçš„æ–‡ä»¶å½“åšæ•°æ®åº“æ¥ä½¿ç”¨,ä½†æ˜¯ç”±äºæ–‡ä»¶ä¸æ–¹ä¾¿ç®¡ç†å’Œä¸å®‰å…¨ï¼Œ
  æ‰€ä»¥åæ¥å°±æœ‰äº†ç¬¬ä¸€ä»£æ•°æ®åº“(å±‚æ¬¡æ¨¡å‹æ•°æ®åº“å’Œç½‘çŠ¶æ¨¡å‹æ•°æ®åº“)
  + ç½‘çŠ¶æ¨¡å‹æ•°æ®åº“æ˜¯å±‚æ¬¡æ¨¡å‹æ•°æ®åº“çš„å‡çº§ç‰ˆ
  + å±‚æ¬¡æ¨¡å‹æ•°æ®åº“ç±»ä¼¼äºHTMLç»“æ„, æ˜¯é€šè¿‡æ ‘çŠ¶ç»“æ„æ¥ä¿å­˜ç®¡ç†æ•°æ®çš„
  + åœ¨å±‚æ¬¡æ¨¡å‹æ•°æ®åº“ä¸­æœ‰ä¸”ä»…æœ‰ä¸€ä¸ªç»“ç‚¹æ²¡æœ‰çˆ¶ç»“ç‚¹ï¼Œå®ƒå°±æ˜¯æ ¹ç»“ç‚¹
  + åœ¨å±‚æ¬¡æ¨¡å‹æ•°æ®åº“ä¸­å…¶å®ƒç»“ç‚¹åªèƒ½æœ‰ä¸€ä¸ªçˆ¶ç»“ç‚¹
  + åœ¨å±‚æ¬¡æ¨¡å‹æ•°æ®åº“ä¸­æ‰€æœ‰çš„å­èŠ‚ç‚¹ä¸èƒ½è„±ç¦»çˆ¶èŠ‚ç‚¹è€Œå•ç‹¬å­˜åœ¨
- åæ¥ç”±äºå±‚æ¬¡æ¨¡å‹å’Œç½‘çŠ¶æ¨¡å‹æ•°æ®åº“çš„ç»“æ„æ¯”è¾ƒå¤æ‚ï¼Œä¸åˆ©äºæ•°æ®åº“çš„ç»´æŠ¤å’Œé‡å»º
  æ‰€ä»¥å°±æœ‰äº†ç¬¬äºŒä»£æ•°æ®åº“(å…³ç³»å‹æ•°æ®åº“å’Œéå…³ç³»å‹æ•°æ®åº“)

**ç¬¬ä¸€ä»£æ•°æ®åº“:**

- å±‚æ¬¡æ¨¡å‹æ•°æ®åº“
    + å…¸å‹ä»£è¡¨æ˜¯IBMå…¬å¸çš„IMSï¼ˆInformation Management Systemï¼‰æ•°æ®åº“ç®¡ç†ç³»ç»Ÿ
- ç½‘çŠ¶æ¨¡å‹æ•°æ®åº“
    + ç”µä¿¡ä»£è¡¨æ˜¯HPå…¬å¸çš„IMAGEã€Cullinet Softwareå…¬å¸çš„ IDMSã€Univacå…¬å¸çš„ DMS1100

**ç¬¬äºŒä»£æ•°æ®åº“:**

- å…³ç³»å‹æ•°æ®åº“
    + æ¯ä¸ªè¡¨éƒ½æ˜¯ç‹¬ç«‹çš„
    + è¡¨ä¸è¡¨ä¹‹é—´é€šè¿‡å…¬å…±å­—æ®µæ¥å»ºç«‹å…³ç³»(ä¾‹å¦‚IDå­—æ®µ)
    + å¤šè¡¨æŸ¥è¯¢æ•ˆç‡ä½
    + SQL Server/Oracle/MySQL

- éå…³ç³»å‹æ•°æ®åº“
    + è§£å†³äº†å…³ç³»å‹æ•°æ®åº“å¤šè¡¨æŸ¥è¯¢çš„æ•ˆç‡é—®é¢˜
    + Redisã€Mongodbç­‰

### 1.4 MySQLçš„å®‰è£…

1. å®‰è£…åŒ…ä¸‹è½½åœ°å€:
   https://dev.mysql.com/downloads/mysql/

2. å®‰è£…è¿‡ç¨‹:
   - é€‰æ‹©è‡ªå®šä¹‰å®‰è£…
   - é€‰æ‹©è¦å®‰è£…çš„ç‰ˆæœ¬
   - ä¿®æ”¹å®‰è£…è·¯å¾„
   - è®¾ç½®æ•°æ®åº“å¯†ç 
   - å…¶å®ƒä¸€å¾‹ä¸‹ä¸€æ­¥

3. æµ‹è¯•æ˜¯å¦å®‰è£…æˆåŠŸ
   - é…ç½®ç¯å¢ƒå˜é‡, å°†å®‰è£…ç›®å½•ä¸­binæ–‡ä»¶å¤¹çš„åœ°å€æ”¾åˆ°ç¯å¢ƒå˜é‡pathä¸­
   - åœ¨ç»ˆç«¯è¾“å…¥ mysql --help æˆ–è€… mysql --version

### 1.5 æ•°æ®åº“çš„è¿æ¥å’Œæ–­å¼€

#### è¿æ¥mysqlæœåŠ¡å™¨

**åŸºæœ¬è¯­æ³•:**

```bash
mysql -h127.0.0.1 -P3306 -uroot -proot
-h ä¸»æœºåœ°å€
-P ç«¯å£å·
-u ç”¨æˆ·å
-p ç”¨æˆ·å¯†ç 
```

æ³¨æ„ç‚¹:

- å¦‚æœMySQLæœåŠ¡å™¨åœ¨æœ¬åœ°, ä¸»æœºåœ°å€å¯ä»¥çœç•¥
- å¦‚æœæœåŠ¡å™¨ä½¿ç”¨é»˜è®¤3306ç«¯å£, ç«¯å£å·å¯ä»¥çœç•¥

```bash
mysql -h127.0.0.1 -P3306 -uroot -proot   é“¾æ¥è¿œç¨‹MySQLæœåŠ¡å™¨
mysql -h127.0.0.1  -uroot -proot  é“¾æ¥è¿œç¨‹MySQLæœåŠ¡å™¨, ä½¿ç”¨é»˜è®¤ç«¯å£3306
mysql -uroot -proot é“¾æ¥æœ¬åœ°çš„MySQLæœåŠ¡å™¨, ä½¿ç”¨é»˜è®¤ç«¯å£3306
mysql -uroot -p  å¯†ç é‡‡ç”¨æš—æ–‡å½¢å¼
```

**æœ€å¸¸ç”¨çš„æ–¹å¼:**

`mysql -h127.0.0.1  -uroot -p ` é“¾æ¥è¿œç¨‹MySQLæœåŠ¡å™¨, ä½¿ç”¨é»˜è®¤ç«¯å£3306

#### é€€å‡ºé“¾æ¥

`exit;`

`quit`

`\q`

#### æ˜¾ç¤ºæ•°æ®åº“

è¯­æ³•æ ¼å¼: `show databases; ` æ³¨æ„: åé¢æœ‰s
**åˆå§‹è¡¨ä»‹ç»**

- information_schema
  - ä¿å­˜ç€å…³äºMySQLæœåŠ¡å™¨æ‰€ç»´æŠ¤çš„æ‰€æœ‰å…¶ä»–æ•°æ®åº“çš„ä¿¡æ¯ã€‚
  - å¦‚æ•°æ®åº“åï¼Œæ•°æ®åº“çš„è¡¨ï¼Œè¡¨æ çš„æ•°æ®ç±»å‹ä¸è®¿é—®æƒé™ç­‰
- mysql
  - MySQLç³»ç»Ÿæ•°æ®åº“, ä¿å­˜äº†ç™»å½•ç”¨æˆ·å,å¯†ç ,ä»¥åŠæ¯ä¸ªç”¨æˆ·çš„æƒé™ç­‰ç­‰
- performance_schema
  - ç”¨æ¥ä¿å­˜æ•°æ®åº“æœåŠ¡å™¨æ€§èƒ½çš„å‚æ•°
- sys
  è¿™ä¸ªåº“æ˜¯é€šè¿‡è§†å›¾çš„å½¢å¼æŠŠinformation_schemaå’Œperformance_schemaç»“åˆèµ·æ¥ï¼ŒæŸ¥è¯¢å‡ºæ›´åŠ ä»¤äººå®¹æ˜“ç†è§£çš„æ•°æ®

### 1.6 æ•°æ®åº“SQLç®€ä»‹

#### å¦‚ä½•ä½¿ç”¨MySQL

1. å­¦ä¹ MySQLå’Œå­¦ä¹ Excelå·®ä¸å¤š
   - ä½¿ç”¨Excelæ­¥éª¤: å®‰è£…Excel-åˆ›å»ºExcelæ–‡ä»¶-åˆ›å»ºè¡¨-åœ¨è¡¨ä¸­å­˜å‚¨æ•°æ®
   - ä½¿ç”¨MySQLæ­¥éª¤: å®‰è£…MySQL-åˆ›å»ºæ•°æ®åº“----åˆ›å»ºè¡¨-åœ¨è¡¨ä¸­å­˜å‚¨æ•°æ®
2. å­¦ä¹ MySQLæœ¬è´¨ä¸Šå°±æ˜¯å­¦ä¹ æ•°æ®åº“çš„å¢åˆ æ”¹æŸ¥(CRUD)
3. åœ¨MySQLä¸­ä¸»è¦æœ‰ä¸‰ç§ç±»å‹çš„å¢åˆ æ”¹æŸ¥, åˆ†åˆ«æ˜¯:
   - æ•°æ®åº“çš„å¢åˆ æ”¹æŸ¥
   - è¡¨çš„å¢åˆ æ”¹æŸ¥
   - æ•°æ®çš„å¢åˆ æ”¹æŸ¥

*MySQLä¸­å¯ä»¥æœ‰0~Nä¸ªæ•°æ®åº“, æ•°æ®åº“ä¸­å¯ä»¥æœ‰0~Nä¸ªè¡¨, è¡¨ä¸­å¯ä»¥æœ‰0~Nä¸ªæ•°æ®*

#### ä»€ä¹ˆæ˜¯SQLï¼Ÿ

ç»“æ„åŒ–æŸ¥è¯¢è¯­è¨€(Structured Query Language)ç®€ç§°
æ˜¯ç”¨æ¥æ“ä½œå…³ç³»å‹æ•°æ®åº“çš„ä¸€é—¨è¯­è¨€
æ˜¯ä¸€ä¸ªå…³ç³»å‹æ•°æ®åº“é€šç”¨çš„æ“ä½œè¯­è¨€

**æ³¨æ„ç‚¹:**
å„å¤§å‚å•†ä¸ºäº†æ›´å¤šçš„å ç”¨å¸‚åœºä»½é¢, éƒ½ä¼šåœ¨æ ‡å‡†çš„SQLåŸºç¡€ä¸Šæ‰©å±•ä¸€äº›è‡ªå·±çš„ä¸œè¥¿
ä¾‹å¦‚: 

- SQL Server  ä½¿ç”¨T-SQL
- Oracle      ä½¿ç”¨PL/SQL
- MySQL       ä½¿ç”¨MySQL

#### SQLè¯­å¥åŠŸèƒ½åˆ’åˆ†

- DDL:æ•°æ®å®šä¹‰è¯­å¥
	ç”¨æ¥å®šä¹‰æ•°æ®åº“å¯¹è±¡ï¼šåˆ›å»ºåº“ï¼Œè¡¨ï¼Œåˆ—ç­‰ã€‚
- DMLï¼šæ•°æ®æ“ä½œè¯­å¥
	ç”¨æ¥æ“ä½œæ•°æ®åº“è¡¨ä¸­çš„è®°å½•
- DQLï¼šæ•°æ®æŸ¥è¯¢è¯­å¥
	ç”¨æ¥æŸ¥è¯¢æ•°æ®
- DCLï¼šæ•°æ®æ§åˆ¶è¯­å¥
	ç”¨æ¥å®šä¹‰è®¿é—®æƒé™å’Œå®‰å…¨çº§åˆ«

#### SQLæ•°æ®ç±»å‹

å’Œå¸¸è§çš„ç¼–ç¨‹è¯­è¨€ä¸€æ ·, æ•°æ®åº“ä¸­å­˜å‚¨çš„æ•°æ®ä¹Ÿæ˜¯åŒºåˆ†ç±»å‹çš„

MySQLä¸­æ”¯æŒçš„æ•°æ®ç±»å‹å¤§è‡´å¯ä»¥åˆ†ä¸ºä¸‰ç±»: æ•°å€¼ç±»å‹ã€å­—ç¬¦ä¸²ç±»å‹å’Œæ—¥æœŸå’Œæ—¶é—´ç±»å‹ https://dev.mysql.com/doc/refman/8.0/en/data-types.html
MySQLä¸­å¸¸ç”¨çš„æ•°æ®ç±»å‹å¦‚ä¸‹:

- doubleï¼šæµ®ç‚¹å‹ï¼Œä¾‹å¦‚double(5,2)è¡¨ç¤ºæœ€å¤š5ä½ï¼Œå…¶ä¸­å¿…é¡»æœ‰2ä½å°æ•°ï¼Œå³æœ€å¤§å€¼ä¸º999.99ï¼›
- charï¼šå›ºå®šé•¿åº¦å­—ç¬¦ä¸²ç±»å‹ï¼› char(10)  'lnj       '
- varcharï¼šå¯å˜é•¿åº¦å­—ç¬¦ä¸²ç±»å‹ï¼›varchar(10) 'lnj'
- textï¼šå­—ç¬¦ä¸²ç±»å‹;
- blobï¼šäºŒè¿›åˆ¶ç±»å‹ï¼›
- dateï¼šæ—¥æœŸç±»å‹ï¼Œæ ¼å¼ä¸ºï¼šyyyy-MM-ddï¼›
- timeï¼šæ—¶é—´ç±»å‹ï¼Œæ ¼å¼ä¸ºï¼šhh:mm:ss
- datetime:æ—¥æœŸæ—¶é—´ç±»å‹ yyyy-MM-dd hh:mm:ss

æ³¨æ„ç‚¹: åœ¨mysqlä¸­ï¼Œå­—ç¬¦ä¸²ç±»å‹å’Œæ—¥æœŸç±»å‹éƒ½è¦ç”¨å•å¼•å·æ‹¬èµ·æ¥ã€‚'lnj'  '2022-02-02'

## ç¬¬ 2 ç« : æ•°æ®åº“å¢åˆ æ”¹æŸ¥

### 2.1 åˆ›å»ºæ•°æ®åº“

è¯­æ³•æ ¼å¼: `create database [if not exists] æ•°æ®åº“åç§° [charset=å­—ç¬¦é›†];`

**ç¤ºä¾‹ä¸€:**

```sql
create database stu;
-- æ³¨æ„ç‚¹: ä»¥ä¸Šè¯­å¥, å¦‚æœMySQLä¸­å·²ç»æœ‰äº†åç§°å«åšstuçš„æ•°æ®åº“, å†æ‰§è¡Œå°±ä¼šæŠ¥é”™
```

**ç¤ºä¾‹äºŒ:**

```sql
create database if not exists person;
-- æ³¨æ„ç‚¹: ä»¥ä¸Šè¯­å¥, å¦‚æœMySQLä¸­å·²ç»æœ‰äº†åç§°å«åšpersonçš„æ•°æ®åº“, å¹¶ä¸ä¼šæŠ¥é”™, è€Œæ˜¯è·³è¿‡è¿™æ¡è¯­å¥
```

**ç¤ºä¾‹ä¸‰:**

```sql
create database if not exists it666 charset=utf8;
-- æ³¨æ„ç‚¹: ä¸ºäº†é¿å…å°†æ¥è¯»å–çš„å­—ç¬¦é›†å’Œå­˜å‚¨çš„å­—ç¬¦é›†ä¸ä¸€æ ·å¯¼è‡´ä¹±ç é—®é¢˜,åœ¨åˆ›å»ºæ•°æ®åº“çš„æ—¶å€™, æˆ‘ä»¬è¿˜éœ€è¦æŒ‡å®šå½“å‰åˆ›å»ºçš„æ•°æ®åº“å°†æ¥ä½¿ç”¨ä»€ä¹ˆç¼–ç æ–¹å¼å­˜å‚¨æ•°æ®
```

#### è¡¥å……è®²è§£

**å¦‚ä½•æŸ¥çœ‹æ•°æ®åº“å…¨å±€é»˜è®¤çš„ç¼–ç **

`show variables like 'character_set_%';`

**å¦‚ä½•æŸ¥çœ‹æŸä¸ªæ•°æ®åº“çš„ç¼–ç **

`show create database person;`

**ç‰¹æ®Šçš„æ•°æ®åº“åç§°å¤„ç†**

```sql
create database if not exists `create` charset=utf8;
-- æ³¨æ„ç‚¹: å¦‚æœæ•°æ®åº“çš„åç§°æ˜¯SQLçš„å…³é”®å­—æˆ–è€…æ˜¯ä¸€äº›ç‰¹æ®Šå­—ç¬¦#~@*&.., è¿™ä¸ªæ—¶å€™å°±éœ€è¦ç”¨åå¼•å·æ‹¬èµ·æ¥
```



### 2.2 åˆ é™¤æ•°æ®åº“

è¯­æ³•æ ¼å¼: `drop database [if exists] æ•°æ®åº“åç§°;`

**ç¤ºä¾‹ä¸€:**

```sql
drop database stu;
-- æ³¨æ„ç‚¹: ä»¥ä¸Šè¯­å¥, å¦‚æœMySQLä¸­æ²¡æœ‰è¦åˆ é™¤çš„æ•°æ®åº“, é‚£ä¹ˆå°±ä¼šæŠ¥é”™
```

**ç¤ºä¾‹äºŒ:**

```sql
drop database if exists person;
-- æ³¨æ„ç‚¹: ä»¥ä¸Šè¯­å¥, å¦‚æœMySQLä¸­æ²¡æœ‰è¦åˆ é™¤çš„æ•°æ®åº“, é‚£ä¹ˆå°±ä¼šè·³è¿‡, å¹¶ä¸ä¼šæŠ¥é”™
```

### 2.3 ä¿®æ”¹æ•°æ®åº“

è¯­æ³•æ ¼å¼: `alter database æ•°æ®åº“åç§° charset=å­—ç¬¦é›†; `

```sql
alter database it666 charset=utf8;
```

### 2.4 æŸ¥çœ‹æ•°æ®åº“

è¯­æ³•æ ¼å¼: 

- `show create database æ•°æ®åº“åç§°;`
- `show databases;`

**å°ç»“:**

```markdown
# æ–°å»º-- C/å¢åŠ 
create database [if not exists] æ•°æ®åº“åç§° [charset=å­—ç¬¦é›†];

# åˆ é™¤-- D/åˆ é™¤
drop database [if exists] æ•°æ®åº“åç§°;

# ä¿®æ”¹-- U/ä¿®æ”¹
alter database æ•°æ®åº“åç§° charset=å­—ç¬¦ç¼–ç 

# è¯»å–-- R/æŸ¥çœ‹
show databases;
show create database æ•°æ®åº“åç§°;
```



## ç¬¬ 3 ç« : è¡¨å¢åˆ æ”¹æŸ¥

**æ³¨æ„ç‚¹:**

- åœ¨å¯¹æ•°æ®åº“çš„è¡¨è¿›è¡Œæ“ä½œçš„æ—¶å€™(å¢åˆ æ”¹æŸ¥), éƒ½å¿…é¡»å…ˆå‘Šè¯‰MySQLæˆ‘ä»¬è¦æ“ä½œçš„æ˜¯å“ªä¸€ä¸ªæ•°æ®åº“
- `use æ•°æ®åº“åç§°;`

**æŸ¥çœ‹æ•°æ®åº“ä¸­æœ‰å“ªäº›è¡¨**

`show tables;`

**æŸ¥çœ‹æŒ‡å®šè¡¨çš„ç»“æ„**

`desc è¡¨å;`

### 3.1 åˆ›å»ºè¡¨

```sql
create table è¡¨å(
  å­—æ®µåç§° æ•°æ®ç±»å‹,
  å­—æ®µåç§° æ•°æ®ç±»å‹,
  å­—æ®µåç§° æ•°æ®ç±»å‹,
  å­—æ®µåç§° æ•°æ®ç±»å‹,
);
```



**ç¤ºä¾‹ä¸€:**

```sql
create table stu(
    id int,
    name text
);
-- æ³¨æ„ç‚¹: ä»¥ä¸Šä»£ç åˆ›å»ºè¡¨, å¦‚æœè¡¨å·²ç»å­˜åœ¨äº†, é‚£ä¹ˆå°±ä¼šæŠ¥é”™
```

**ç¤ºä¾‹äºŒ:**

```sql
create table if not exists person(
    id int,
    name text
);
-- æ³¨æ„ç‚¹: ä»¥ä¸Šä»£ç åˆ›å»ºè¡¨, æ²¡æœ‰å°±ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„, æœ‰å°±ä¼šè‡ªåŠ¨è·³è¿‡
```



### 3.2 åˆ é™¤è¡¨

`drop table è¡¨å;`

**ç¤ºä¾‹ä¸€:**

```sql
drop table stu;
-- æ³¨æ„ç‚¹: ä»¥ä¸Šè¯­å¥, å¦‚æœåˆ é™¤çš„è¡¨ä¸å­˜åœ¨, é‚£ä¹ˆå°±ä¼šæŠ¥é”™
```

**ç¤ºä¾‹äºŒ:**

```sql
drop table if exists person;
-- æ³¨æ„ç‚¹: ä»¥ä¸Šè¯­å¥, å¦‚æœéœ€è¦åˆ é™¤çš„è¡¨å­˜åœ¨, é‚£ä¹ˆå°±ç›´æ¥åˆ é™¤, å¦‚æœä¸å­˜åœ¨å°±è·³è¿‡
```



### 3.3 ä¿®æ”¹è¡¨

#### ä¿®æ”¹è¡¨å

`rename table åŸå§‹åç§° to æ–°çš„åç§°;`

```sql
rename table stu to person;
```



#### æ·»åŠ å­—æ®µ

`alter table è¡¨å add æ–°å¢å­—æ®µåç§° æ–°å¢å­—æ®µæ•°æ®ç±»å‹ [ä½ç½®];`

```sql
alter table person add age int;
-- æ³¨æ„ç‚¹: é»˜è®¤æƒ…å†µä¸‹ä¼šå°†æ–°å¢çš„å­—æ®µæ”¾åˆ°åŸæœ‰å­—æ®µçš„åé¢
```

```sql
alter table person add score float first;
-- æ³¨æ„ç‚¹: æˆ‘ä»¬å¯ä»¥é€šè¿‡æŒ‡å®šfirstå°†æ–°å¢çš„å­—æ®µæ”¾åˆ°åŸæœ‰å­—æ®µçš„å‰é¢
```

```sql
alter table person add phone int after name;
-- æ³¨æ„ç‚¹: æˆ‘ä»¬å¯ä»¥é€šè¿‡afteræŒ‡å®šå°†æ–°å¢çš„å­—æ®µæ”¾åˆ°å“ªä¸ªå­—æ®µçš„åé¢
```



#### åˆ é™¤å­—æ®µ

`alter table è¡¨å drop å­—æ®µåç§°;`

```sql
alter table person drop phone;
```



#### ä¿®æ”¹å­—æ®µ

**ä¿®æ”¹å­—æ®µçš„æ•°æ®ç±»å‹**

`alter table è¡¨å modify éœ€è¦ä¿®æ”¹çš„å­—æ®µåç§° æ–°çš„æ•°æ®ç±»å‹`

```sql
alter table person modify score double;
```



**ä¿®æ”¹å­—æ®µçš„åç§°å’Œæ•°æ®ç±»å‹**

`alter table è¡¨å change åŸå§‹å­—æ®µåç§° æ–°çš„å­—æ®µåç§° æ–°çš„æ•°æ®ç±»å‹;`

```sql
alter table person change age addr text;
```



### 3.4 MySQLå­˜å‚¨å¼•æ“

#### ä»€ä¹ˆæ˜¯å­˜å‚¨å¼•æ“

MySQLä¸­çš„å­˜å‚¨å¼•æ“å°±å¥½æ¯”æˆ‘ä»¬ç°å®ç”Ÿæ´»ä¸­çš„é“¶è¡Œ, ä¸åŒçš„é“¶è¡Œæä¾›çš„å®‰å…¨çº§åˆ«ã€æœåŠ¡æ°´å¹³ã€å­˜å‚¨åŠŸèƒ½ä¸ä¸€æ ·

å’Œç°å®ç”Ÿæ´»ä¸­ä¸€æ ·åœ¨MySQLä¹Ÿæœ‰å„ç§å„æ ·ä¸åŒçš„é“¶è¡Œ, è¿™äº›é“¶è¡Œæˆ‘ä»¬ç§°ä¹‹ä¸ºå­˜å‚¨å¼•æ“

å’Œç°å®ç”Ÿæ´»ä¸­ä¸€æ ·MySQLä¸­ä¸åŒçš„å­˜å‚¨å¼•æ“æä¾›çš„å®‰å…¨çº§åˆ«ã€æœåŠ¡æ°´å¹³ã€å­˜å‚¨åŠŸèƒ½ç­‰ä¹Ÿä¸ä¸€æ ·

***MySQLä¸­æœ‰ä¸‰ç§å­˜å‚¨å¼•æ“, åˆ†åˆ«æ˜¯:***

+ MyISAM: å®‰å…¨æ€§ä½, ä½†ä¸æ”¯æŒäº‹åŠ¡å’Œå¤–é”®, é€‚åˆé¢‘ç¹æ’å…¥å’ŒæŸ¥è¯¢çš„åº”ç”¨
+ InnoDB(é»˜è®¤): å®‰å…¨æ€§é«˜, æ”¯æŒäº‹åŠ¡å’Œå¤–é”®, é€‚åˆå¯¹å®‰å…¨æ€§, æ•°æ®å®Œæ•´æ€§è¦æ±‚è¾ƒé«˜çš„åº”ç”¨
+ Memory: è®¿é—®é€Ÿåº¦æå¿«, ä½†ä¸ä¼šæ°¸ä¹…å­˜å‚¨æ•°æ®, é€‚åˆå¯¹è¯»å†™é€Ÿåº¦è¦æ±‚è¾ƒé«˜çš„åº”ç”¨

#### æŒ‡å®šå­˜å‚¨å¼•æ“

```sql
-- åˆ›å»ºè¡¨æ—¶æŒ‡å®š
create table stu(
    id int,
    name text
)engine=å¼•æ“åç§°;

-- åˆ›å»ºè¡¨åæŒ‡å®š
alter table è¡¨å engine=å¼•æ“åç§°;
alter table stu engine=MyISAM;
```



#### ä¸åŒå¼•æ“çš„æœ¬è´¨

- å‰é¢æˆ‘ä»¬è¯´è¿‡æ•°æ®åº“çš„æœ¬è´¨å°±æ˜¯æ–‡ä»¶, æ‰€ä»¥æˆ‘ä»¬å¯ä»¥å…ˆè§‚å¯Ÿä¸€ä¸‹
- é€šè¿‡æˆ‘ä»¬çš„è§‚å¯Ÿ, æˆ‘ä»¬å‘ç°åªè¦åˆ›å»ºä¸€ä¸ªæ•°æ®åº“å°±ä¼šè‡ªåŠ¨åˆ›å»ºä¸€ä¸ªæ–‡ä»¶å¤¹
- é€šè¿‡æˆ‘ä»¬çš„è§‚å¯Ÿ, æˆ‘ä»¬å‘ç°åªè¦åˆ›å»ºä¸€å¼ è¡¨å°±ä¼šåœ¨æŒ‡å®šçš„æ•°æ®åº“æ–‡ä»¶å¤¹ä¸­åˆ›å»ºä¸€ä¸ªæ–‡ä»¶
- åˆ›å»ºè¡¨çš„æ—¶å€™è‡ªåŠ¨åˆ›å»ºçš„è¿™ä¸ªæ–‡ä»¶å°±ä¿å­˜äº†è¿™å¼ è¡¨çš„ç»“æ„

```sql
create table stu(
    id int,
    name varchar(20)
)engine=Memory;
```

**InnoDB:**
   - å¦‚æœè¡¨çš„å­˜å‚¨å¼•æ“æ˜¯InnoDB, é‚£ä¹ˆåªè¦åˆ›å»ºè¡¨å°±ä¼šè‡ªåŠ¨åˆ›å»ºä¸€ä¸ªæ–‡ä»¶, è¿™ä¸ªæ–‡ä»¶å°±ä¿å­˜äº†è¿™å¼ è¡¨çš„ç»“æ„
   - å¦‚æœå¾€InnoDBçš„è¡¨ä¸­å­˜å‚¨æ•°æ®, é‚£ä¹ˆæ•°æ®ä¼šè¢«å­˜å‚¨åˆ°ibdata1çš„æ–‡ä»¶ä¸­, å¦‚æœå­˜å‚¨çš„æ•°æ®æ¯”è¾ƒå¤š, é‚£ä¹ˆç³»ç»Ÿä¼šè‡ªåŠ¨å†åˆ›å»ºibdata2, ibdata3, ...æ–‡ä»¶

**MyISAM:**
    - å¦‚æœè¡¨çš„å­˜å‚¨å¼•æ“æ˜¯MyISAM, é‚£ä¹ˆåªè¦åˆ›å»ºè¡¨å°±ä¼šè‡ªåŠ¨åˆ›å»ºä¸‰ä¸ªæ–‡ä»¶
        + .sdiè¿™ä¸ªæ–‡ä»¶å°±ä¿å­˜äº†è¿™å¼ è¡¨çš„ç»“æ„
        + .MYDè¿™ä¸ªæ–‡ä»¶å°±ä¿å­˜äº†è¿™å¼ è¡¨ä¸­å­˜å‚¨çš„æ•°æ®
        + .MYIè¿™ä¸ªæ–‡ä»¶å°±ä¿å­˜äº†è¿™å¼ è¡¨ä¸­çš„ç´¢å¼•

**Memory:**

    - å¦‚æœè¡¨çš„å­˜å‚¨å¼•æ“æ˜¯Memory, é‚£ä¹ˆåªè¦åˆ›å»ºè¡¨å°±ä¼šè‡ªåŠ¨åˆ›å»ºä¸€ä¸ªæ–‡ä»¶, è¿™ä¸ªæ–‡ä»¶å°±ä¿å­˜äº†è¿™å¼ è¡¨çš„ç»“æ„
        - æ³¨æ„ç‚¹: å¦‚æœè¡¨çš„å­˜å‚¨å¼•æ“æ˜¯Memory, é‚£ä¹ˆå°±ä¸ä¼šåƒInnoDB/MyISAMå°†æ•°æ®ä¿å­˜åˆ°æ–‡ä»¶ä¸­äº†, è€Œæ˜¯ç›´æ¥ä¿å­˜åˆ°å†…å­˜ä¸­

## ç¬¬ 4 ç«  : æ•°æ®å¢åˆ æ”¹æŸ¥

### 4.1 æ’å…¥æ•°æ®

*å‘æŒ‡å®šçš„è¡¨ä¸­æ’å…¥æ•°æ®*

`insert into è¡¨å (å­—æ®µåç§°1, å­—æ®µåç§°2) values (å€¼1, å€¼2);`

**ç¤ºä¾‹:**

```sql
create table if not exists stu(
    id int,
    name varchar(20)
);
insert into stu (id, name) values (1, 'lnj');
# æ³¨æ„ç‚¹: åœ¨æ’å…¥æ•°æ®çš„æ—¶å€™æŒ‡å®šçš„å­—æ®µåç§°çš„é¡ºåºä¸ç”¨å’Œè¡¨ä¸­çš„å­—æ®µåç§°çš„é¡ºåºä¸€è‡´
insert into stu (name, id) values ('zs', 2);
# æ³¨æ„ç‚¹: åœ¨æ’å…¥æ•°æ®çš„æ—¶å€™æŒ‡å®šçš„å–å€¼é¡ºåºå¿…é¡»å’ŒæŒ‡å®šçš„å­—æ®µåç§°é¡ºåºä¸€è‡´
insert into stu (name, id) values (3, 'ls');
# æ³¨æ„ç‚¹: å¦‚æœæ’å…¥æ•°æ®æ—¶æŒ‡å®šçš„å–å€¼é¡ºåºå’Œè¡¨ä¸­çš„å­—æ®µé¡ºåºæ˜¯ä¸€è‡´çš„, é‚£ä¹ˆå¯ä»¥ä¸æŒ‡å®šå­—æ®µåç§°
insert into stu values (3, 'ls');
# æ³¨æ„ç‚¹: æˆ‘ä»¬å¯ä»¥é€šè¿‡valuesåŒæ—¶æ’å…¥å¤šæ¡æ•°æ®
insert into  stu values (4, 'ww'), (5, 'zl');
```



### 4.2 æ›´æ–°æ•°æ®

*å°†æŒ‡å®šè¡¨ä¸­çš„æ•°æ®è¿›è¡Œæ›´æ–°(ä¿®æ”¹)*

`update è¡¨å set å­—æ®µåç§°=å€¼ [where æ¡ä»¶];`

**ç¤ºä¾‹:**

```sql
# æ³¨æ„ç‚¹: å¦‚æœåœ¨æ›´æ–°æ•°æ®çš„æ—¶å€™æ²¡æœ‰æŒ‡å®šæ¡ä»¶, é‚£ä¹ˆå°±ä¼šæ›´æ–°æ•´å¼ è¡¨ä¸­çš„æ•°æ®
update stu set score=77;
# æ³¨æ„ç‚¹: å¦‚æœåœ¨æ›´æ–°æ•°æ®çš„æ—¶å€™æŒ‡å®šäº†æ¡ä»¶, é‚£ä¹ˆåªä¼šæ›´æ–°æ»¡è¶³æ¡ä»¶çš„æ•°æ®
update stu set score=88 where name='ls';
# æ³¨æ„ç‚¹: åœ¨æŒ‡å®šæ¡ä»¶çš„æ—¶å€™, æˆ‘ä»¬å¯ä»¥é€šè¿‡ANDæ¥æŒ‡å®šå¤šä¸ªæ¡ä»¶, AND===&&
update stu set score=100 where name='lnj' AND id=5;
# æ³¨æ„ç‚¹: åœ¨æŒ‡å®šæ¡ä»¶çš„æ—¶å€™, æˆ‘ä»¬å¯ä»¥é€šè¿‡ORæ¥æŒ‡å®šå¤šä¸ªæ¡ä»¶, OR===||
update stu set score=66 where name='zs' OR name='ww';
# æ³¨æ„ç‚¹: åœ¨æ›´æ–°æ•°æ®çš„æ—¶å€™æ˜¯å¯ä»¥åŒæ—¶æ›´æ–°å¤šä¸ªå­—æ®µçš„
update stu set name='it666', score=33 where id=5;
```



### 4.3 æŸ¥çœ‹æ•°æ®

*æŸ¥çœ‹æŒ‡å®šè¡¨ä¸­æœ‰å“ªäº›æ•°æ®*

#### å…¨å±€æŸ¥è¯¢

`select * from è¡¨å;`

**æ³¨æ„ç‚¹:** 

- ä»¥ä¸Šæ–¹å¼ä¼šå°†è¡¨ä¸­æ‰€æœ‰çš„æ•°æ®éƒ½æŸ¥è¯¢å‡ºæ¥, æ‰€ä»¥æ€§èƒ½æ¯”è¾ƒå·®
- ä»¥ä¸Šæ–¹å¼ä¼šå°†è¡¨ä¸­æ‰€æœ‰çš„æ•°æ®éƒ½æŸ¥è¯¢å‡ºæ¥, ä¸èƒ½æŸ¥è¯¢ç‰¹å®šå­—æ®µçš„å€¼
- æ‰€æœ‰å¼•å…¥äº†ä¸‹é¢è¿™ç§whereæŸ¥è¯¢æ–¹å¼

#### whereæŸ¥è¯¢

 `select å­—æ®µåç§°1, å­—æ®µåç§°2 from è¡¨å [where æ¡ä»¶];`

```sql
# æŸ¥è¯¢ç‰¹å®šå­—æ®µçš„æ•°æ®
select name from stu;
# æŸ¥è¯¢æ»¡è¶³æ¡ä»¶çš„æ•°æ®
select * from stu where score > 60;
select id, name from stu where score > 60;
select * from stu where score = 77 || score = 88;
select * from stu where score in (77, 88);
select * from stu where score BETWEEN 77 AND 88;
select * from stu where score IS NOT NULL;
select * from stu where score IS NULL;
```

**whereæ”¯æŒçš„è¿ç®—ç¬¦**

```
=ï¼ˆç­‰äºï¼‰ã€!=ï¼ˆä¸ç­‰äºï¼‰ã€<>ï¼ˆä¸ç­‰äºï¼‰ã€<ï¼ˆå°äºï¼‰ã€<=ï¼ˆå°äºç­‰äºï¼‰ã€>ï¼ˆå¤§äºï¼‰ã€>=ï¼ˆå¤§äºç­‰äºï¼‰ï¼›
IN(set)ï¼›å›ºå®šçš„èŒƒå›´å€¼
BETWEENâ€¦ANDï¼›å€¼åœ¨ä»€ä¹ˆèŒƒå›´
IS NULLï¼›ï¼ˆä¸ºç©ºï¼‰ IS NOT NULLï¼ˆä¸ä¸ºç©ºï¼‰
ANDï¼›ä¸
ORï¼›æˆ–
NOTï¼›é
LIKE: æ¨¡ç³ŠæŸ¥è¯¢
```





### 4.4 åˆ é™¤æ•°æ®

*åˆ é™¤æŒ‡å®šè¡¨ä¸­çš„æ•°æ®*

`delete from è¡¨å [where æ¡ä»¶];`

```sql
# åˆ é™¤æ»¡è¶³æ¡ä»¶çš„æ•°æ®
delete from stu where score > 60;
# åˆ é™¤æ‰€æœ‰çš„æ•°æ®
delete from stu;
```



## ç¬¬ 5 ç« : æ•°æ®ç±»å‹

**MySQLä¸ºä»€ä¹ˆè¦æä¾›æ•°æ®ç±»å‹?**å¦‚æœæ²¡æœ‰æ•°æ®ç±»å‹, é‚£ä¹ˆMySQLå°±ä¸çŸ¥é“éœ€è¦åˆ†é…å¤šå¤§çš„å­˜å‚¨ç©ºé—´æ¥å­˜å‚¨ä½ çš„æ•°æ®è¿‡å¤§ä¼šæµªè´¹ä¼šé€ æˆèµ„æºæµªè´¹, ä½“ç§¯å˜å¤§æ•ˆç‡å˜ä½, è¿‡å°å¯èƒ½å¯¼è‡´æ•°æ®æº¢å‡ºä¸èƒ½å®Œæ•´çš„ä¿å­˜æ•°æ®æ‰€ä»¥MySQLæä¾›æ•°æ®ç±»å‹çš„ç›®çš„æ˜¯ä¸ºäº†è®©æˆ‘ä»¬åˆç†çš„åˆ†é…å­˜å‚¨ç©ºé—´, é™ä½æ•°æ®åº“çš„ä½“ç§¯ä¸ºäº†è®©æˆ‘ä»¬åˆç†çš„åˆ†é…å­˜å‚¨ç©ºé—´, å®Œæ•´çš„ä¿å­˜æ•°æ®ä¸ºäº†æ›´å¥½çš„å¯¹æ•°æ®åº“è¿›è¡Œä¼˜åŒ–

**MySQLä¸­æœ‰å“ªäº›æ•°æ®ç±»å‹?** æ•´å‹ç±»å‹/æµ®ç‚¹ç±»å‹/å®šç‚¹ç±»å‹/å­—ç¬¦ç±»å‹/æ–‡æœ¬ç±»å‹/æšä¸¾ç±»å‹/é›†åˆç±»å‹/æ—¥æœŸç±»å‹/å¸ƒå°”ç±»å‹

### 5.1 æ•´æ•°ç±»å‹

æ•´æ•°ç±»å‹ä¸“é—¨ç”¨æ¥ä¿å­˜æ•´æ•°çš„

```
TINYINT	        1 å­—èŠ‚	(-128ï¼Œ127)	(0ï¼Œ255)	å°æ•´æ•°å€¼
SMALLINT	    2 å­—èŠ‚	(-32 768ï¼Œ32 767)	(0ï¼Œ65 535)	å¤§æ•´æ•°å€¼
MEDIUMINT	    3 å­—èŠ‚	(-8 388 608ï¼Œ8 388 607)	(0ï¼Œ16 777 215)	å¤§æ•´æ•°å€¼
INTæˆ–INTEGER	4 å­—èŠ‚	(-2 147 483 648ï¼Œ2 147 483 647)	(0ï¼Œ4 294 967 295)	å¤§æ•´æ•°å€¼
BIGINT	        8 å­—èŠ‚	(-9,223,372,036,854,775,808ï¼Œ9 223 372 036 854 775 807)	(0ï¼Œ18 446 744 073 709 551 615)	æå¤§æ•´æ•°å€¼
```

**æ³¨æ„ç‚¹:**

1. MySQLä¸­çš„æ•´å‹å’Œå…¶å®ƒç¼–ç¨‹è¯­è¨€çš„æ•´å‹ä¸€æ ·, ä¹ŸåŒºåˆ†æœ‰ç¬¦å·å’Œæ— ç¬¦å·

   - é»˜è®¤æƒ…å†µä¸‹æ•´å‹å°±æ˜¯æœ‰ç¬¦å·çš„
   - å¯ä»¥åœ¨æ•°æ®ç±»å‹çš„åé¢åŠ ä¸Š unsigned æ¥å°†æ•°æ®ç±»å‹å˜æˆæ— ç¬¦å·çš„

   2. åœ¨è®¾è®¡æ•°æ®åº“çš„æ—¶å€™ä¸€å®šè¦åˆç†çš„ä½¿ç”¨æ•°æ®ç±»å‹
                 + ä¾‹å¦‚: æˆ‘ä»¬è¦ä¿å­˜ä¸€ä¸ªäººçš„å¹´é¾„ (æ•´æ•°)
                         +   
                 æˆ‘ä»¬åº”è¯¥ä½¿ç”¨TINYINTç±»å‹, å› ä¸ºäººæœ€å¤šæ´»åˆ°255å²å·²ç»ä¸Šå¤©äº†, æ‰€ä»¥ä½¿ç”¨æœ€å°çš„æ•´å‹å³å¯
                 
             
                 å¦‚æœä½¿ç”¨å…¶å®ƒçš„æ•´å‹, å°±ä¼šé€ æˆèµ„æºæµªè´¹, æ•°æ®åº“ä½“ç§¯å˜å¤§, æ•ˆç‡å˜ä½...

3. åœ¨ä¿å­˜æ•°æ®çš„æ—¶å€™, å¦‚æœè¶…å‡ºäº†å½“å‰æ•°æ®ç±»å‹çš„èŒƒå›´, é‚£ä¹ˆå°±ä¼šæŠ¥é”™
4. åœ¨è®¾ç½®æ•´å‹çš„æ—¶å€™, è¿˜å¯ä»¥è®¾ç½®æ•´å‹æ•°æ®å°†æ¥æ˜¾ç¤ºçš„ä½å®½
   - ä¾‹å¦‚: ç°åœ¨è®¾ç½®å°†æ¥æ˜¾ç¤ºæ•´å‹çš„ä½å®½æ˜¯2, ç°åœ¨å­˜å‚¨çš„æ•°æ®1, é‚£ä¹ˆå°†æ¥æŸ¥è¯¢å‡ºæ¥çš„æ•°æ®å°±ä¼šæ˜¾ç¤ºæˆ 1;
   - 2020-2-3 -- 2020-02-03
   - æ³¨æ„ç‚¹: å¦‚æœå­˜å‚¨çš„æ•°æ®æ²¡æœ‰æŒ‡å®šçš„ä½å®½å®½, é‚£ä¹ˆå°±ä¼šè‡ªåŠ¨è¡¥ç©ºæ ¼æˆ–è€…0, å¦‚æœå¤§äºæˆ–è€…ç­‰äºäº†æŒ‡å®šçš„ä½å®½, é‚£ä¹ˆæ¯›éƒ½ä¸åš

```sql
create table person(
    id int,
    age tinyint
);
insert into person values (1, -128);
insert into person values (1, 127);
insert into person values (1, 128); #æŠ¥é”™

create table person2(
    id int,
    age tinyint unsigned
);
insert into person values (1, -128); #æŠ¥é”™
insert into person values (1, 127);
insert into person values (1, 128);

create table person3(
    id int,
    age tinyint(2) zerofill
);
insert into person values (1, 1);   #01
insert into person values (1, 12);  #12
insert into person values (1, 123); #123
```



### 5.2 æµ®ç‚¹ç±»å‹

æµ®ç‚¹ç±»å‹ä¸“é—¨ç”¨æ¥ä¿å­˜å°æ•°çš„

```
FLOAT(m, d)	    4 å­—èŠ‚	å•ç²¾åº¦
DOUBLE(m, d)	8 å­—èŠ‚	åŒç²¾åº¦
```

*è¯´æ˜: mæ€»ä½æ•°, då°æ•°ä½æ•°*

**floatå’Œdoubleçš„åŒºåˆ«**

- å ç”¨å­˜å‚¨ç©ºé—´å¤§å°ä¸ä¸€æ ·
- é»˜è®¤ä¿ç•™çš„å°æ•°ä½æ•°ä¸åŒ
- ä¿å­˜æ•°æ®çš„æœ‰æ•ˆç²¾åº¦ä¹Ÿä¸åŒ

**æµ®ç‚¹ç±»å‹ç‰¹ç‚¹**

- å’Œå…¶å®ƒç¼–ç¨‹è¯­è¨€ä¸­ä¸€æ ·, æµ®ç‚¹ç±»å‹æ˜¯ä¸å‡†ç¡®çš„
- æ‰€ä»¥åœ¨ä¼ä¸šå¼€å‘ä¸­åƒä¸‡ä¸è¦ä½¿ç”¨æµ®ç‚¹æ•°æ¥ä¿å­˜ç”¨æˆ·çš„å‡†ç¡®(çè´µ)ä¿¡æ¯(RMB)

**ç¤ºä¾‹ä¸€: é»˜è®¤ä¿ç•™çš„å°æ•°ä½æ•°ä¸åŒ**

```sql
create table person(
    id int,
    weight FLOAT,
    height DOUBLE
);
insert into person values (1, 1.12345678901234567890, 1.12345678901234567890);
-- weight: 1.12346
-- height: 1.1234567890123457
```

**ç¤ºä¾‹äºŒ: æ‰‹åŠ¨æŒ‡å®šå°æ•°çš„æ€»ä½æ•°å’Œå°æ•°éƒ¨åˆ†çš„ä½æ•°**

```sql
create table person2(
    id int,
    weight FLOAT(10, 6),
    height DOUBLE(10, 6)
);
insert into person2 values (1, 1.12345678901234567890, 1.12345678901234567890);
-- weight: 1.123457
-- height: 1.123457
```

**ç¤ºä¾‹ä¸‰: ä¿å­˜æ•°æ®çš„æœ‰æ•ˆç²¾åº¦ä¹Ÿä¸åŒ**

```sql
create table person3(
    id int,
    weight FLOAT(20, 19),
    height DOUBLE(20, 19)
);
insert into person3 values (1, 1.12345678901234567890, 1.12345678901234567890);
weight: 1.123456-8357467651000
height: 1.123456789012345-7000
```



### 5.3 å®šç‚¹ç±»å‹

å®šç‚¹ç±»å‹ä¹Ÿæ˜¯ç”¨äºå­˜å‚¨å°æ•°çš„

```
decimal(M, D)
```

*è¯´æ˜: mæ€»ä½æ•°, då°æ•°ä½æ•°*

**å®šç‚¹ç±»å‹çš„æœ¬è´¨**: æ˜¯å°†æ•°æ®åˆ†ä¸ºä¸¤ä¸ªéƒ¨åˆ†æ¥å­˜å‚¨, æ¯ä¸ªéƒ¨åˆ†éƒ½æ˜¯æ•´æ•°æ‰€ä»¥å®šç‚¹æ•°ä¸è¦æ»¥ç”¨, å› ä¸ºéå¸¸æ¶ˆè€—èµ„æº

```sql
create table person4(
    id int,
    weight decimal(21, 20),
    height decimal(21, 20)
);
insert into person4 values (1, 1.12345678901234567890, 1.12345678901234567890);
-- weight: 1.12345678901234567890
-- height: 1.12345678901234567890
```



### 5.4 å­—ç¬¦ç±»å‹

*å­—ç¬¦ç±»å‹ä¸“é—¨ç”¨æ¥å­˜å‚¨å­—ç¬¦çš„*

```
 CHAR(size)	    0-255  å­—èŠ‚	    å®šé•¿å­—ç¬¦ä¸²
 VARCHAR(size)	0-65535å­—èŠ‚	    å˜é•¿å­—ç¬¦ä¸²
```

**charå’ŒvarcharåŒºåˆ«**

- èƒ½å¤Ÿä¿å­˜æ•°æ®çš„å®¹é‡ä¸ä¸€æ ·
- charä¸ä¼šå›æ”¶å¤šä½™çš„å­—ç¬¦,  è¦å¤šå°‘ç»™å¤šå°‘
- varcharä¼šå›æ”¶å¤šä½™çš„å­—ç¬¦, ç”¨å¤šå°‘ç»™å¤šå°‘
  - ä¾‹å¦‚: é€šè¿‡    char(2)å­˜å‚¨å­˜å‚¨æ•°æ®'a', å­˜å‚¨çš„ç»“æœæ˜¯' a';
  - ä¾‹å¦‚: é€šè¿‡ varchar(2)å­˜å‚¨å­˜å‚¨æ•°æ®'a', å­˜å‚¨çš„ç»“æœæ˜¯'a';

**ç¤ºä¾‹ä¸€:**

```sql
create table person(
    id int,
    name1 char(2),
    name2 varchar(2)
);
insert into person values (1, 'a', 'b');
insert into person values (1, '12', '34');
insert into person values (1, 'abc', 'def'); #åªè¦è¶…å‡ºç”³è¯·çš„èŒƒå›´å°±ä¼šæŠ¥é”™
```

**ç¤ºä¾‹äºŒ:**

```sql
create table person2(
    id int,
    name1 char(255),
    name2 varchar(255)
);
# 65535 / 3 = 21845, ç”±äºutf8ä¸€ä¸ªå­—ç¬¦å ç”¨3ä¸ªå­—èŠ‚, æ‰€ä»¥varcharåœ¨utf8çš„è¡¨ä¸­æœ€å¤šåªèƒ½å­˜å‚¨21845ä¸ªå­—ç¬¦
# 65535 / 2 = 32767, ç”±äºgbkä¸€ä¸ªå­—ç¬¦å ç”¨2ä¸ªå­—èŠ‚,æ‰€ä»¥varcharåœ¨gbkçš„è¡¨ä¸­æœ€å¤šåªèƒ½å­˜å‚¨32767ä¸ªå­—ç¬¦
create table person3(
    id int,
    name1 char(255),
    name2 varchar(65535)
)charset=gbk;
Column length too big for column 'name2' (max = 21845); use BLOB or TEXT instead
Column length too big for column 'name2' (max = 32767); use BLOB or TEXT instead
```

æ³¨æ„ç‚¹: 

- ç”±äºæ˜¯å­—ç¬¦ç±»å‹, æ‰€ä»¥ä¼ é€’å€¼å»ºè®®ç”¨å•å¼•å·''
- VARCHARç†è®ºä¸Šå¯ä»¥å­˜å‚¨65535ä¸ªå­—ç¬¦, ä½†æ˜¯å®é™…ä¼šéšç€å½“å‰æ•°æ®åº“çš„å­—ç¬¦é›†æ”¹å˜

### 5.5 å¤§æ–‡æœ¬ç±»å‹

MySQLä¸­æ¯ä¸€è¡Œå­˜å‚¨çš„æ•°æ®æ˜¯æœ‰å¤§å°é™åˆ¶çš„, æ¯ä¸€è¡Œæœ€å¤šåªèƒ½å­˜å‚¨65534ä¸ªå­—èŠ‚

```sql
 create table person(
     #name1 char(3),
     name2 varchar(21844) #åœ¨UTF8ä¸­ç›¸å½“äº65535ä¸ªå­—èŠ‚
 )charset=utf8;
# Row size too large. The maximum row size for the used table type, not counting BLOBs, is 65535. This includes storage overhead, check the manual. You have to change some columns to TEXT or BLOBs
```

```
 TINYTEXT	0-255å­—èŠ‚	        çŸ­æ–‡æœ¬å­—ç¬¦ä¸²
 TEXT	    0-65535å­—èŠ‚	        é•¿æ–‡æœ¬æ•°æ®
 MEDIUMTEXT	0-16777215å­—èŠ‚	    ä¸­ç­‰é•¿åº¦æ–‡æœ¬æ•°æ®
 LONGTEXT	0-4294967295å­—èŠ‚    æå¤§æ–‡æœ¬æ•°æ®
```

```sql
 create table person2(
    name1 char(3),
    name2 TEXT #ä¸ä¼šæŠ¥é”™, å› ä¸ºæ²¡æœ‰è¶…å‡ºæ˜¾ç¤º, å®é™…åªå ç”¨10ä¸ªå­—èŠ‚
)charset=utf8;
```

æ³¨æ„ç‚¹:

- å¤§æ–‡æœ¬ç±»å‹åœ¨è¡¨ä¸­å¹¶ä¸ä¼šå®é™…å ç”¨æ‰€èƒ½ä¿å­˜çš„å­—èŠ‚æ•°, è€Œæ˜¯åˆ©ç”¨10ä¸ªå­—èŠ‚å¼•ç”¨äº†å®é™…ä¿å­˜æ•°æ®çš„åœ°å€

### 5.6 æšä¸¾ç±»å‹

å’Œå…¶å®ƒç¼–ç¨‹è¯­è¨€ä¸€æ ·, å¦‚æœæŸä¸ªå­—æ®µçš„å–å€¼åªèƒ½æ˜¯å‡ ä¸ªå›ºå®šå€¼ä¸­çš„ä¸€ä¸ª, é‚£ä¹ˆå°±å¯ä»¥ä½¿ç”¨æšä¸¾

```
enum(å€¼1, å€¼2, ...);
```

```sql
create table person(
    id int,
    gender enum('ç”·', 'å¥³', 'å¦–')
);
insert into person values (1, 'ç«'); #ä¼šæŠ¥é”™
insert into person values (1, 'ç”·'); #ä¸ä¼šæŠ¥é”™
insert into person values (2, 'å¥³'); #ä¸ä¼šæŠ¥é”™
insert into person values (3, 'å¦–'); #ä¸ä¼šæŠ¥é”™
```

æ³¨æ„ç‚¹:

- MySQLä¸­çš„æšä¸¾ç±»å‹å’Œå…¶å®ƒçš„ç¼–ç¨‹è¯­è¨€ä¸€æ ·, åº•å±‚éƒ½æ˜¯ä½¿ç”¨æ•´å‹æ¥å®ç°çš„

  - å’Œå…¶å®ƒç¼–ç¨‹è¯­è¨€ä¸å¤ªä¸€æ ·çš„æ˜¯, å…¶å®ƒç¼–ç¨‹è¯­è¨€çš„æšä¸¾éƒ½æ˜¯ä»0å¼€å§‹çš„, è€ŒMySQLçš„æšä¸¾æ˜¯ä»1å¼€å§‹çš„select gender+0 from person;

- ç”±äºMySQLçš„æšä¸¾åº•å±‚æ˜¯ä½¿ç”¨æ•´å‹å®ç°çš„, æ‰€ä»¥æˆ‘ä»¬åœ¨èµ‹å€¼çš„æ—¶å€™é™¤äº†å¯ä»¥èµ‹å€¼å›ºå®šçš„å‡ ä¸ªå€¼å…¶ä¸­çš„ä¸€ä¸ªæ„å¤–æˆ‘ä»¬è¿˜å¯ä»¥èµ‹å€¼å¯¹åº”çš„æ•´æ•°

  ```sql
  insert into person values (4, 1); #ä¸ä¼šæŠ¥é”™
  insert into person values (4, 4); #ä¼šæŠ¥é”™
  ```

  

### 5.7 é›†åˆç±»å‹

*å’Œç¼–ç¨‹å¼€å‘ä¸­ä¸€æ ·, å¦‚æœæŸä¸ªå­—æ®µçš„å–å€¼åªèƒ½æ˜¯å‡ ä¸ªå›ºå®šå€¼ä¸­çš„å‡ ä¸ª, é‚£ä¹ˆå°±å¯ä»¥ä½¿ç”¨é›†åˆç±»å‹*

```
set(å€¼1, å€¼2, ...)
```

```sql
create table person(
    id int,
    hobby set('ç¯®çƒ','è¶³çƒ','é«˜å°”å¤«çƒ','è¶³æµ´')
);
insert into person values (1, 'ç¯®çƒ,è¶³çƒ,é«˜å°”å¤«çƒ'); #ä¸ä¼šæŠ¥é”™
insert into person values (1, 'æ©„æ¦„çƒ');  #ä¼šæŠ¥é”™

insert into person values (2, 'ç¯®çƒ'); #ä¸ä¼šæŠ¥é”™  1
insert into person values (3, 'è¶³çƒ'); #ä¸ä¼šæŠ¥é”™  2
insert into person values (4, 'é«˜å°”å¤«çƒ'); #ä¸ä¼šæŠ¥é”™  4
insert into person values (5, 'è¶³æµ´'); #ä¸ä¼šæŠ¥é”™  8
```

æ³¨æ„ç‚¹:

- MySQLçš„é›†åˆç±»å‹ä¹Ÿæ˜¯ä½¿ç”¨æ•´å‹æ¥å®ç°çš„ select hobby+0 from person;

- MySQLçš„é›†åˆç±»å‹æ˜¯æŒ‰ç…§2(n)çš„æ–¹å¼æ¥å®ç°çš„

  ```
  2(0) = 1
  2(1) = 2
  2(2) = 4
  2(3) = 8
  ```

### 5.8 å¸ƒå°”ç±»å‹

å¸ƒå°”ç±»å‹ ä¸“é—¨ç”¨æ¥ä¿å­˜çœŸå‡çš„

```sql
create table person(
    id int,
    flag boolean
);
insert into person values (1, 'ç”·'); #ä¼šæŠ¥é”™
insert into person values (1, true); #ä¸ä¼šæŠ¥é”™
insert into person values (2, false); #ä¸ä¼šæŠ¥é”™
```

æ³¨æ„ç‚¹:

- MySQLä¸­çš„å¸ƒå°”ç±»å‹ä¹Ÿæ˜¯ä½¿ç”¨æ•´å‹æ¥å®ç°çš„, 0å°±è¡¨ç¤ºå‡, 1å°±è¡¨ç¤ºçœŸ

  - åº•å±‚çš„æœ¬è´¨æ˜¯å› ä¸ºMySQLæ˜¯ä½¿ç”¨C/C++æ¥å®ç°çš„, æ‰€ä»¥å°±æ˜¯'éé›¶å³çœŸ'

  ```sql
  insert into person values (3, 1); #ä¸ä¼šæŠ¥é”™
  insert into person values (4, 0); #ä¸ä¼šæŠ¥é”™
  insert into person values (5, 2); #ä¸ä¼šæŠ¥é”™
  ```

  

### 5.9 æ—¥æœŸç±»å‹

*æ—¥æœŸç±»å‹ - ä¸“é—¨ç”¨æ¥ä¿å­˜æ—¶é—´çš„*

```
 DATE	    3å­—èŠ‚	YYYY-MM-DD	æ—¥æœŸå€¼
 TIME	    3å­—èŠ‚	HH:MM:SS	æ—¶é—´å€¼æˆ–æŒç»­æ—¶é—´
 DATETIME	8å­—èŠ‚	YYYY-MM-DD HH:MM:SS	æ··åˆæ—¥æœŸå’Œæ—¶é—´å€¼
```

æ³¨æ„ç‚¹: åœ¨å­˜å‚¨æ—¶é—´çš„æ—¶å€™, éœ€è¦ç”¨å•å¼•å·å°†æ—¶é—´æ‹¬èµ·æ¥

```sql
create table person(
    id int,
    filed1 DATE,
    filed2 TIME,
    filed3 DATETIME
);
insert into person values (1, '2020-02-02', '14:18:23', '2020-02-02 14:18:23');
```





## ç¬¬ 6 ç« : æ•°æ®å®Œæ•´æ€§

**ä»€ä¹ˆæ˜¯æ•°æ®çš„å®Œæ•´æ€§?** ä¿è¯ä¿å­˜åˆ°æ•°æ®åº“ä¸­çš„æ•°æ®éƒ½æ˜¯æ­£ç¡®çš„ã€‚

**å¦‚ä½•ä¿è¯æ•°æ®å®Œæ•´æ€§?** 

- æ•°æ®çš„å®Œæ•´æ€§å¯ä»¥åˆ†ä¸ºä¸‰ç±»: å®ä½“å®Œæ•´æ€§ã€åŸŸå®Œæ•´æ€§ã€å‚ç…§å®Œæ•´æ€§
- æ— è®ºæ˜¯å“ªä¸€ç§å®Œæ•´æ€§éƒ½æ˜¯åœ¨åˆ›å»ºè¡¨æ—¶ç»™è¡¨æ·»åŠ çº¦æŸå³å¯

### 6.1 å®ä½“å®Œæ•´æ€§

å®ä½“å®Œæ•´æ€§

1. ä»€ä¹ˆæ˜¯å®ä½“? è¡¨ä¸­çš„ä¸€è¡Œæ•°æ®å°±æ˜¯ä¸€ä¸ªå®ä½“ï¼ˆentityï¼‰
2. å¦‚ä½•ä¿è¯å®ä½“å®Œæ•´æ€§? ä¿è¯å®ä½“å®Œæ•´æ€§å°±æ˜¯ä¿è¯æ¯ä¸€è¡Œæ•°æ®çš„å”¯ä¸€æ€§

å®ä½“å®Œæ•´æ€§çš„çº¦æŸç±»å‹: 

```
	ä¸»é”®çº¦æŸï¼ˆprimary keyï¼‰
	å”¯ä¸€çº¦æŸ(unique)
	è‡ªåŠ¨å¢é•¿åˆ—(auto_increment)
```

#### ä¸»é”®çº¦æŸï¼ˆprimary keyï¼‰

ä¸»é”®ç”¨äºå”¯ä¸€æ ‡è¯†è¡¨ä¸­çš„æ¯ä¸€æ¡æ•°æ®, å’Œç°å®ç”Ÿæ´»ä¸­çš„èº«ä»½è¯å¾ˆåƒ

```sql
create table person2(
    id int primary key,
    name varchar(20)
);
insert into person2 values (1, 'lnj');
insert into person2 values (2, 'lnj');
```

ä¸»é”®çš„ç‰¹å¾:
- å¦‚æœå°†æŸä¸€ä¸ªå­—æ®µè®¾ç½®æˆäº†ä¸»é”®, é‚£ä¹ˆè¿™ä¸ªå­—æ®µçš„å–å€¼å°±ä¸èƒ½é‡å¤äº†

- å¦‚æœå°†æŸä¸€ä¸ªå­—æ®µè®¾ç½®æˆäº†ä¸»é”®, é‚£ä¹ˆè¿™ä¸ªå­—æ®µçš„å–å€¼å°±ä¸èƒ½æ˜¯nulläº†

- ä¸€å¼ è¡¨ä¸­åªèƒ½æœ‰ä¸€ä¸ªä¸»é”®, ä¸èƒ½å‡ºç°å¤šä¸ªä¸»é”®

  ```sql
  create table person3(
      id int primary key,
      name varchar(20) primary key
  );
  ```

- æˆ‘ä»¬é™¤äº†å¯ä»¥åœ¨å­—æ®µæ•°æ®ç±»å‹åé¢æ·»åŠ primary key, å°†è¿™ä¸ªå­—æ®µå˜æˆä¸»é”®ä»¥å¤–,è¿˜å¯ä»¥é€šè¿‡åœ¨æœ€åå†™ä¸Šprimary key(å­—æ®µåç§°)çš„æ–¹å¼æ¥æŒ‡å®šä¸»é”®

  ```sql
  create table person3(
      id int,
      name varchar(20),
      primary key(id)
  );
  insert into person3 values (1, 'lnj');
  insert into person3 values (1, 'lnj');
  ```

##### è”åˆä¸»é”®

**ä»€ä¹ˆæ˜¯è”åˆä¸»é”®?** æˆ‘ä»¬é€šè¿‡å°†è¡¨ä¸­çš„æŸä¸ªæ°¸è¿œä¸é‡å¤çš„å­—æ®µè®¾ç½®ä¸ºä¸»é”®, ä»è€Œè¾¾åˆ°ä¿è¯æ¯ä¸€è¡Œæ•°æ®çš„å”¯ä¸€æ€§(å®ä½“å®Œæ•´æ€§)ä½†æ˜¯åœ¨ä¼ä¸šå¼€å‘ä¸­æœ‰æ—¶å€™æˆ‘ä»¬å¯èƒ½æ‰¾ä¸åˆ°ä¸é‡å¤çš„å­—æ®µ, æ­¤æ—¶æˆ‘ä»¬è¿˜å¯ä»¥é€šè¿‡è”åˆä¸»é”®çš„æ–¹å¼æ¥ä¿è¯æ¯ä¸€è¡Œæ•°æ®çš„å”¯ä¸€æ€§è”åˆä¸»é”®å°±æ˜¯åŒæ—¶å°†å¤šä¸ªå­—æ®µä½œä¸ºä¸€ä¸ªä¸»é”®æ¥ä½¿ç”¨

```
 ________
|name| age|
|lnj | 88 |
|zs  | 88 |
|lnj | 33 |
```

```sql
create table person(
    name varchar(20),
    age int,
    primary key(name, age)
);
insert into person values ('lnj', 88);
insert into person values ('lnj', 88);
```

**æ³¨æ„ç‚¹:** è”åˆä¸»é”®å¹¶ä¸æ˜¯æ·»åŠ å¤šä¸ªä¸»é”®, è€Œæ˜¯å°†å¤šä¸ªå­—æ®µçš„å€¼ä½œä¸ºä¸»é”®æ¥ä½¿ç”¨ä¹Ÿå°±æ˜¯è¿‡å»æˆ‘ä»¬æŒ‡å®šidä¸ºä¸»é”®, é‚£ä¹ˆidçš„å–å€¼ä¸èƒ½é‡å¤è€Œç°åœ¨å¦‚æœæˆ‘ä»¬æŒ‡å®š nameå’Œageä¸ºä¸»é”®, é‚£ä¹ˆname+ageçš„å€¼ä¸èƒ½é‡å¤





#### å”¯ä¸€çº¦æŸ(unique)

å”¯ä¸€çº¦æŸç”¨äºä¿è¯æŸä¸ªå­—æ®µçš„å€¼æ°¸è¿œä¸é‡å¤

```sql
create table person(
    id int unique,
    name varchar(20)
);
insert into person values (1, 'lnj');
insert into person values (1, 'lnj');
```

**ä¸»é”®å’Œå”¯ä¸€é”®å¼‚åŒ:**

- å”¯ä¸€çº¦æŸå’Œä¸»é”®çº¦æŸä¸€æ ·, è¢«çº¦æŸçš„å­—æ®µçš„å–å€¼éƒ½ä¸èƒ½å¤Ÿé‡å¤

- ä¸»é”®åœ¨ä¸€å¼ è¡¨ä¸­åªèƒ½æœ‰ä¸€ä¸ª, è€Œå”¯ä¸€çº¦æŸåœ¨ä¸€å¼ è¡¨ä¸­å¯ä»¥æœ‰å¤šä¸ª

  ```sql
  create table person2(
      id int unique,
      name varchar(20) unique
  );
  insert into person2 values (1, 'lnj');
  insert into person2 values (2, 'lnj');
  ```

- ä¸»é”®çš„å–å€¼ä¸èƒ½ä¸ºNull, è€Œå”¯ä¸€çº¦æŸçš„å–å€¼å¯ä»¥æ˜¯Null

#### è‡ªåŠ¨å¢é•¿çº¦æŸ(auto_increment)

è‡ªåŠ¨å¢é•¿çº¦æŸçš„ä½œç”¨æ˜¯è®©æŸä¸ªå­—æ®µçš„å–å€¼ä»1å¼€å§‹é€’å¢, ä»è€Œä¿è¯å®ä½“å®Œæ•´æ€§

```sql
create table person(
    id int auto_increment,
    name varchar(20)
);
#Incorrect table definition; there can be only one auto column and it must be defined as a key
```

**æ³¨æ„ç‚¹:** 

- å¦‚æœæŸä¸ªå­—æ®µæ˜¯è‡ªåŠ¨å¢é•¿çš„, é‚£ä¹ˆè¿™ä¸ªå­—æ®µå¿…é¡»æ˜¯ä¸»é”®æ‰å¯ä»¥

  ```sql
  create table person(
      id int auto_increment primary key,
      name varchar(20)
  );
  insert into person values (1, 'lnj');
  ```

- å¦‚æœä»…ä»…æ˜¯ä¸»é”®, é‚£ä¹ˆå–å€¼ä¸èƒ½æ˜¯null, ä½†æ˜¯å¦‚æœä¸»é”®è¿˜æ˜¯è‡ªåŠ¨å¢é•¿çš„, é‚£ä¹ˆå–å€¼å°±å¯ä»¥æ˜¯nullæˆ–è€…default

- åœ¨ä¼ä¸šå¼€å‘ä¸­æˆ‘ä»¬åº”è¯¥å¦‚ä½•é€‰æ‹©ä¸»é”®

  - æœ€å°‘æ€§: èƒ½ç”¨ä¸€ä¸ªå­—æ®µä½œä¸ºä¸»é”®, å°±ä¸è¦ä½¿ç”¨å¤šä¸ªå­—æ®µ
  - ç¨³å®šæ€§: èƒ½ç”¨ä¸è¢«æ“ä½œ(ä¿®æ”¹)çš„å­—æ®µä½œä¸ºä¸»é”®, å°±ä¸è¦ä½¿ç”¨ä¼šè¢«æ“ä½œçš„å­—æ®µä½œä¸ºä¸»é”®
  - ä¸€èˆ¬æƒ…å†µä¸‹æˆ‘ä»¬ä¼šå®šä¹‰ä¸€ä¸ªåç§°å«åšidçš„å­—æ®µ, å¹¶ä¸”è¿™ä¸ªå­—æ®µæ˜¯æ•´å‹çš„, å¹¶ä¸”è¿™ä¸ªå­—æ®µæ˜¯è‡ªåŠ¨å¢é•¿çš„æ¥ä½œä¸ºä¸»é”®



##### å¦‚ä½•ä¿®çº¦æŸ

1. å¦‚ä½•ä¿®æ”¹ä¸»é”®çº¦æŸ

   ```sql
   alter table è¡¨å add primary key(å­—æ®µ);
   create table person(
       id int,
       name varchar(20)
   );
   alter table person add primary key(id);
   insert into person values (1, 'lnj');
   ```

2. å¦‚ä½•ä¿®æ”¹å”¯ä¸€çº¦æŸ

   ```sql
   alter table è¡¨å add unique(å­—æ®µ);
   create table person2(
       id int,
       name varchar(20)
   );
   alter table person2 add unique(name);
   insert into person2 values (1, 'lnj');
   ```

3. å¦‚ä½•ä¿®æ”¹è‡ªåŠ¨å¢é•¿çº¦æŸ

   ```sql
   alter table è¡¨å modify å­—æ®µåç§° æ•°æ®ç±»å‹ auto_increment;
   create table person3(
       id int,
       name varchar(20)
   );
   alter table person3 modify id int auto_increment;
   insert into person3 values (null, 'lnj');
   ```

   





### 6.2 åŸŸå®Œæ•´æ€§

**ä»€ä¹ˆæ˜¯åŸŸ?** ä¸€è¡Œæ•°æ®ä¸­çš„æ¯ä¸ªå•å…ƒæ ¼éƒ½æ˜¯ä¸€ä¸ªåŸŸ

**å¦‚ä½•ä¿è¯åŸŸçš„å®Œæ•´æ€§?**

- ä¿è¯åŸŸçš„å®Œæ•´æ€§å°±æ˜¯ä¿è¯æ¯ä¸ªå•å…ƒæ ¼æ•°æ®çš„æ­£ç¡®æ€§
- ä½¿ç”¨æ­£ç¡®çš„æ•°æ®ç±»å‹
  - ä¾‹å¦‚: äººçš„å¹´é¾„ä¸å¯èƒ½è¶…è¿‡255å², è€Œä¸”ä¸èƒ½æ˜¯è´Ÿæ•°, æ‰€ä»¥æˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨ TINYINT UNSIGNED
  - ä¾‹å¦‚: äººçš„æ€§åˆ«åªèƒ½æ˜¯ç”·/å¥³æˆ–è€…å¦–, æ‰€ä»¥æˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨æšä¸¾ç±»å‹
  - ä¾‹å¦‚: è¦å­˜å‚¨æ¯”è¾ƒå¤šçš„æ–‡å­—, ä¸ºäº†ä¿è¯ä¸è¶…å‡ºæ¯ä¸€è¡Œæœ€å¤§çš„å­˜å‚¨é™åˆ¶, æˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨å¤§æ–‡æœ¬ç±»å‹
- ä½¿ç”¨éç©ºçº¦æŸï¼ˆnot nullï¼‰
- ä½¿ç”¨é»˜è®¤å€¼çº¦æŸ(default)



**ç¤ºä¾‹:**

```sql
create table person(
    id int,
    name varchar(20) not null
);
insert into person values (1, null);

create table person2(
    id int,
    name varchar(20) default 'it666'
);
insert into person2 values (1, null);
insert into person2 values (1, default);
insert into person2 values (1, 'zs');
-- æ³¨æ„ç‚¹: å“ªæ€•è®¾ç½®äº†é»˜è®¤å€¼, ä¼ å…¥nullä¹‹åä¹Ÿä¸ä¼šä½¿ç”¨é»˜è®¤å€¼
```





### 6.3 å‚ç…§å®Œæ•´æ€§

**å‚ç…§å®Œæ•´æ€§** åˆç§°å¼•ç”¨å®Œæ•´æ€§, ä¸»è¦ç”¨äºä¿è¯å¤šè¡¨ä¹‹é—´å¼•ç”¨å…³ç³»çš„æ­£ç¡®æ€§

**ä¸ºä»€ä¹ˆè¦åˆ›å»ºå¤šå¼ è¡¨?åˆ†æå¦‚ä¸‹**

```bash
ç¤ºä¾‹: å®šä¹‰ä¸€å¼ è¡¨ä¿å­˜2ä¸ªå­¦ç”Ÿ3é—¨è¯¾ç¨‹çš„æˆç»©
|---------------------------------|
| id | name | gender | km | score |
| 1  | å¼ ä¸‰ |   ç”·   |è¯­æ–‡|  100  |
| 2  | å¼ ä¸‰ |   ç”·   |æ•°å­¦|   99  |
| 3  | å¼ ä¸‰ |   ç”·   |è‹±è¯­|   98  |
| 4  | æå›› |   å¥³   |è¯­æ–‡|   60  |
| 5  | æå›› |   å¥³   |æ•°å­¦|   59  |
| 6  | æå›› |   å¥³   |è‹±è¯­|   58  |
|---------------------------------|
å¦‚æœå°†æ‰€æœ‰çš„æ•°æ®éƒ½æ”¾åˆ°ä¸€å¼ è¡¨ä¸­, ä¼šå‡ºç°å¤§é‡å†—ä½™æ•°æ®

æ‰€ä»¥ä¸ºäº†é™ä½æ•°æ®åº“çš„ä½“ç§¯, æå‡æ•°æ®åº“çš„æ•ˆç‡, æˆ‘ä»¬éœ€è¦æ ¹æ®è‡ªèº«éœ€æ±‚å¯¹è¡¨è¿›è¡Œæ‹†åˆ†
|--------------------|      |-----------------------|
| id | name | gender |      | id | km | score | uid |
| 1  | å¼ ä¸‰ |   ç”·   |      |  1 |è¯­æ–‡|  100  |  1  |
| 2  | æå›› |   å¥³   |      |  2 |æ•°å­¦|   99  |  1  |
|--------------------|      |  3 |è‹±è¯­|   98  |  1  |
                            |  4 |è¯­æ–‡|   60  |  2  |
                            |  5 |æ•°å­¦|   59  |  2  |
                            |  6 |è‹±è¯­|   58  |  2  |
                            |-----------------------|
```

ä»€ä¹ˆæ—¶å€™ä¼šå‡ºç°å†—ä½™æ•°æ®?ä¼šç‰µæ‰¯åˆ°æ•°æ®åº“ä¸­è¡¨ä¸è¡¨ä¹‹é—´çš„å¯¹åº”å…³ç³»

#### è¡¨ä¸è¡¨çš„å¯¹åº”å…³ç³»

*è¡¨ä¸è¡¨ä¹‹é—´çš„å…³ç³»å¯ä»¥åˆ†ä¸ºä¸‰ç§: ä¸€å¯¹ä¸€ã€ä¸€å¯¹å¤šã€å¤šå¯¹å¤š*

##### ä¸€å¯¹ä¸€(ä¸€èˆ¬ä¸éœ€è¦æ‹†åˆ†): 

- ä¸€å¤«ä¸€å¦»åˆ¶

```bash
|-----------------------------|
| id | name | gender | mateId |
| 1  | å¼ ä¸‰ |   ç”·   |    2   |
| 2  | æå›› |   å¥³   |    1   |
| 3  | ç‹äº” |   ç”·   |    4   |
| 4  | èµµå…­ |   å¥³   |    2   |
|-----------------------------|
```

##### ä¸€å¯¹å¤š(ä¸€èˆ¬éœ€è¦æ‹†åˆ†):

- ä¸€ä¸ªäººæœ‰å¤šä¸ªæ±½è½¦
- ä¸€ä¸ªç­æœ‰å¤šä¸ªå­¦ç”Ÿ
- ä¸€ä¸ªäººæœ‰å¤šä»¬æˆç»©

```bash
|---------------------------------|
| id | name | gender | km | score |
| 1  | å¼ ä¸‰ |   ç”·   |è¯­æ–‡|  100  |
| 2  | å¼ ä¸‰ |   ç”·   |æ•°å­¦|   99  |
| 3  | å¼ ä¸‰ |   ç”·   |è‹±è¯­|   98  |
| 4  | æå›› |   å¥³   |è¯­æ–‡|   60  |
| 5  | æå›› |   å¥³   |æ•°å­¦|   59  |
| 6  | æå›› |   å¥³   |è‹±è¯­|   58  |
|---------------------------------|

|--------------------|      |-----------------------|
| id | name | gender |      | id | km | score | uid |
| 1  | å¼ ä¸‰ |   ç”·   |      |  1 |è¯­æ–‡|  100  |  1  |
| 4  | æå›› |   å¥³   |      |  2 |æ•°å­¦|   99  |  1  |
|--------------------|      |  3 |è‹±è¯­|   98  |  1  |
                            |  4 |è¯­æ–‡|   60  |  2  |
                            |  5 |æ•°å­¦|   59  |  2  |
                            |  6 |è‹±è¯­|   58  |  2  |
                            |-----------------------|
```

##### å¤šå¯¹å¤š(ä¸€èˆ¬éœ€è¦æ‹†åˆ†):

- ä¸€ä¸ªå­¦ç”Ÿæœ‰å¤šä¸ªè€å¸ˆ, ä¸€ä¸ªè€å¸ˆæœ‰å¤šä¸ªå­¦ç”Ÿ

```bash
|--------------------------------------------|
| id | stuName | gender | teacherName | æ€§åˆ« |
| 1  |   å¼ ä¸‰  |   ç”·   |     ç‹äº”    |  ç”·  |
| 2  |   å¼ ä¸‰  |   ç”·   |     èµµå…­    |  å¥³  |
| 3  |   å¼ ä¸‰  |   ç”·   |     å‘¨ä¸ƒ    |  ç”·  |
| 4  |   æå››  |   å¥³   |     ç‹äº”    |  ç”·  |
| 5  |   æå››  |   å¥³   |     èµµå…­    |  å¥³  |
| 6  |   æå››  |   å¥³   |     å‘¨ä¸ƒ    |  ç”·  |
|--------------------------------------------|

|-----------------------|  |---------------------|   |-----------------------|
| id | stuName | gender |  | stuId  | teacherId  |   | id | stuName | gender |
| 1  |   å¼ ä¸‰  |   ç”·   |  |    1   |     1      |   | 1  |   ç‹äº”  |   ç”·   |
| 2  |   æå››  |   å¥³   |  |    1   |     2      |   | 2  |   èµµå…­  |   å¥³   |
|-----------------------|  |    1   |     3      |   | 3  |   å‘¨ä¸ƒ  |   ç”·   |
                           |    2   |     1      |   |-----------------------|
                           |    2   |     2      |
                           |    2   |     3      |
                           |---------------------|
```

#### å¤–é”®

##### å¦‚ä½•ä¿è¯å‚ç…§å®Œæ•´æ€§

é»˜è®¤æƒ…å†µä¸‹è¡¨ä¸è¡¨ä¹‹é—´æ˜¯ç‹¬ç«‹å­˜åœ¨çš„, ä¸ä¼šç›¸äº’å½±å“ä¹Ÿæ­£æ˜¯å› ä¸ºå¦‚æ­¤, é»˜è®¤æƒ…å†µä¸‹ä¹Ÿä¸ä¼šæ£€æŸ¥è¡¨ä¸è¡¨ä¹‹é—´çš„ä¾èµ–å…³ç³»æ‰€ä»¥ä¸ºäº†ä¿è¯è¡¨ä¸è¡¨ä¹‹é—´å‚ç…§å®Œæ•´æ€§, æˆ‘ä»¬å¯ä»¥é€šè¿‡'å¤–é”®'æ¥ä¿è¯å‚ç…§å®Œæ•´æ€§

```sql
create table stu(
    id int auto_increment primary key,
    name varchar(20),
    gender enum('ç”·','å¥³','å¦–')
);
create table grade(
    id int auto_increment primary key,
    km varchar(20),
    score double,
    uid int
);

insert into stu values (null, 'zs', 'ç”·');
insert into stu values (null, 'ls', 'å¥³');

insert into grade values (null, 'è¯­æ–‡', 100, 1);
insert into grade values (null, 'æ•°å­¦', 99, 1);
insert into grade values (null, 'è‹±è¯­', 98, 1);
insert into grade values (null, 'è¯­æ–‡', 100, 3);
insert into grade values (null, 'æ•°å­¦', 99, 3);
insert into grade values (null, 'è‹±è¯­', 98, 3);
```

##### ä»€ä¹ˆæ˜¯å¤–é”®

å¦‚æœä¸€å¼ è¡¨ä¸­æœ‰ä¸€ä¸ªå­—æ®µæŒ‡å‘äº†åˆ«ä¸€å¼ è¡¨ä¸­çš„ä¸»é”®ï¼Œå°±å°†è¯¥å­—æ®µå«åšå¤–é”®

```bash
ä¾‹å¦‚: æˆç»©è¡¨ä¸­çš„uidå¼•ç”¨äº†å­¦ç”Ÿè¡¨ä¸­çš„id, é‚£ä¹ˆæˆç»©è¡¨ä¸­çš„uidæˆ‘ä»¬å°±ç§°ä¹‹ä¸ºå¤–é”®
|--------------------|      |-----------------------|
| id | name | gender |      | id | km | score | uid |
| 1  | å¼ ä¸‰ |   ç”·   |      |  1 |è¯­æ–‡|  100  |  1  |
| 2  | æå›› |   å¥³   |      |  2 |æ•°å­¦|   99  |  1  |
|--------------------|      |  3 |è‹±è¯­|   98  |  1  |
                            |  4 |è¯­æ–‡|   60  |  2  |
                            |  5 |æ•°å­¦|   59  |  2  |
                            |  6 |è‹±è¯­|   58  |  2  |
                            |-----------------------|
```

```sql
create table grade2(
    id int auto_increment primary key,
    km varchar(20),
    score double,
    uid int,
    foreign key(uid) references stu(id)
);
insert into grade2 values (null, 'è¯­æ–‡', 100, 1);
insert into grade2 values (null, 'æ•°å­¦', 99, 1);
insert into grade2 values (null, 'è‹±è¯­', 98, 1);
insert into grade2 values (null, 'è¯­æ–‡', 100, 3);
insert into grade2 values (null, 'æ•°å­¦', 99, 3);
insert into grade2 values (null, 'è‹±è¯­', 98, 3);
```

##### å¤–é”®æ³¨æ„ç‚¹

- åªæœ‰InnoDBçš„å­˜å‚¨å¼•æ“æ‰æ”¯æŒå¤–é”®çº¦æŸ
- å¤–é”®çš„æ•°æ®ç±»å‹å¿…é¡»å’ŒæŒ‡å‘çš„ä¸»é”®ä¸€æ ·
- åœ¨ä¸€å¯¹å¤šçš„å…³ç³»ä¸­, å¤–é”®ä¸€èˆ¬å®šä¹‰åœ¨å¤šçš„ä¸€æ–¹(ä¸€ä¸ªå­¦ç”Ÿæœ‰å¤šé—¨æˆç»©, é‚£ä¹ˆå¤–é”®å®šä¹‰åœ¨æˆç»©è¡¨ä¸­)
- å®šä¹‰å¤–é”®çš„è¡¨æˆ‘ä»¬ç§°ä¹‹ä¸ºä»è¡¨, è¢«å¤–é”®å¼•ç”¨çš„è¡¨æˆ‘ä»¬ç§°ä¹‹ä¸ºä¸»è¡¨

##### åˆ›å»ºè¡¨æ—¶å®šä¹‰å¤–é”®

`foreign key(å¤–é”®å­—æ®µåç§°) references ä¸»è¡¨åç§°(ä¸»è¡¨ä¸»é”®åç§°);`

##### å¦‚ä½•åŠ¨æ€æ·»åŠ å¤–é”®

```sql
alter table ä»è¡¨åç§° add foreign key(å¤–é”®å­—æ®µåç§°) references ä¸»è¡¨åç§°(ä¸»è¡¨ä¸»é”®åç§°);
create table grade(
    id int auto_increment primary key,
    km varchar(20),
    score double,
    uid int
);
insert into grade values (null, 'è¯­æ–‡', 100, 3);
alter table grade add foreign key(uid) references stu(id);
insert into grade values (null, 'è¯­æ–‡', 100, 3);
```

##### å¦‚ä½•æŸ¥çœ‹å¤–é”®æ˜¯è°

`show create table ä»è¡¨åç§°;`

```sql
show create table grade;
CREATE TABLE `grade` (
  `id` int NOT NULL AUTO_INCREMENT,
  `km` varchar(20) DEFAULT NULL,
  `score` double DEFAULT NULL,
  `uid` int DEFAULT NULL,
  PRIMARY KEY (`id`),
  KEY `uid` (`uid`),
  CONSTRAINT `grade_ibfk_1` FOREIGN KEY (`uid`) REFERENCES `stu` (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=3 DEFAULT CHARSET=utf8
æ³¨æ„ç‚¹:
- CONSTRAINT `grade_ibfk_1` FOREIGN KEY (`uid`) REFERENCES `stu` (`id`)å«ä¹‰
    + å°†uidå˜æˆå¤–é”®, å¤–é”®çš„åç§°æ˜¯grade_ibfk_1
    + uidçš„å–å€¼å¼•ç”¨çš„æ˜¯stuè¿™å¼ è¡¨ä¸­çš„idå­—æ®µçš„å€¼
```



##### å¦‚ä½•åŠ¨æ€åˆ é™¤å¤–é”® 

`alter table ä»è¡¨åç§° drop foreign key å¤–é”®åç§°;`

```sql
alter table grade drop foreign key grade_ibfk_1;
insert into grade values (null, 'è¯­æ–‡', 100, 3);
```

##### å¤–é”®çš„æ“ä½œ(æ¨¡å¼)

###### ä¸¥æ ¼æ“ä½œ

(å‰é¢è®²è§£çš„éƒ½æ˜¯ä¸¥æ ¼æ“ä½œ)

- ä¸»è¡¨ä¸å­˜åœ¨å¯¹åº”æ•°æ®,ä»è¡¨ä¸å…è®¸æ·»åŠ 

  ```sql
  insert into grade values (null, 'è¯­æ–‡', 100, 3);
  ```

- ä»è¡¨å¼•ç”¨ç€æ•°æ®,ä¸»è¡¨ä¸å…è®¸åˆ é™¤

  ```sql
  delete from stu where id=1;
  ```

- ä»è¡¨å¼•ç”¨è¿™æ•°æ®, ä¸»è¡¨ä¸å…è®¸ä¿®æ”¹

  ```sql
  update stu set id=3 where id=1;
  ```

###### ç½®ç©ºæ“ä½œ(null)

- åœ¨ä¼ä¸šå¼€å‘ä¸­, æˆ‘ä»¬å¯èƒ½å¿…é¡»è¦åˆ é™¤ä¸»è¡¨ä¸­çš„æ•°æ®, ä½†æ˜¯å¦‚æœä¸»è¡¨è¢«åˆ é™¤äº†ä»è¡¨å°±ä¸å®Œæ•´äº†
- æ‰€ä»¥åœ¨ä¼ä¸šå¼€å‘ä¸­, æˆ‘ä»¬å¯ä»¥é€šè¿‡ç½®ç©ºæ“ä½œ, åœ¨åˆ é™¤ä¸»è¡¨æ•°æ®çš„åŒæ—¶åˆ é™¤ä»è¡¨å…³è”çš„æ•°æ®

```sql
create table grade2(
    id int auto_increment primary key,
    km varchar(20),
    score double,
    uid int,
    foreign key(uid) references stu(id) on delete set null
);
insert into grade values (null, 'è¯­æ–‡', 100, 1);
delete from stu where id=1;
```

###### çº§è”æ“ä½œ(cascade)

- åœ¨ä¼ä¸šå¼€å‘ä¸­, æˆ‘ä»¬å¯èƒ½å¿…é¡»è¦ä¿®æ”¹ä¸»è¡¨ä¸­çš„æ•°æ®, ä½†æ˜¯å¦‚æœä¸»è¡¨è¢«ä¿®æ”¹äº†ä»è¡¨å°±ä¸å®Œæ•´äº†
- æ‰€ä»¥åœ¨ä¼ä¸šå¼€å‘ä¸­, æˆ‘ä»¬å¯ä»¥é€šè¿‡'çº§è”æ“ä½œ', åœ¨ä¿®æ”¹ä¸»è¡¨æ•°æ®çš„åŒæ—¶ä¿®æ”¹ä»è¡¨å…³è”çš„æ•°æ®

```sql
create table grade3(
    id int auto_increment primary key,
    km varchar(20),
    score double,
    uid int,
    foreign key(uid) references stu(id) on update cascade
);
insert into grade values (null, 'è¯­æ–‡', 100, 1);
update stu set id=1 where id=3;

[constraint å¤–é”®åç§°] foreign key(å¤–é”®å­—æ®µ) references ä¸»è¡¨(ä¸»é”®)[ä¸»è¡¨åˆ é™¤çš„åŠ¨ä½œ][ä¸»è¡¨æ›´æ–°çš„åŠ¨ä½œ]
ä¸€èˆ¬æƒ…å†µä¸‹ä¸»è¡¨åˆ é™¤æ—¶ä»è¡¨ç½®ç©º, ä¸»è¡¨æ›´æ–°æ—¶ä»è¡¨çº§è”
```

##### å¤šå¯¹å¤šå¤–é”®

```bash
        å­¦ç”Ÿè¡¨                     å…³ç³»è¡¨                     æ•™å¸ˆè¡¨
|-----------------------|  |---------------------|   |-----------------------|
| id | stuName | gender |  | stuId  | teacherId  |   | id | stuName | gender |
| 1  |   å¼ ä¸‰  |   ç”·   |  |    1   |     1      |   | 1  |   ç‹äº”  |   ç”·   |
| 2  |   æå››  |   å¥³   |  |    1   |     2      |   | 2  |   èµµå…­  |   å¥³   |
|-----------------------|  |    1   |     3      |   | 3  |   å‘¨ä¸ƒ  |   ç”·   |
                           |    2   |     1      |   |-----------------------|
                           |    2   |     2      |
                           |    2   |     3      |
                           |---------------------|
```

```sql
create table stu(
    id int auto_increment primary key,
    name varchar(20),
    gender enum('ç”·','å¥³','å¦–')
);
insert into stu values (null, 'å¼ ä¸‰', 'ç”·');
insert into stu values (null, 'æå››', 'å¥³');

create table teacher(
    id int auto_increment primary key,
    name varchar(20),
    gender enum('ç”·','å¥³','å¦–')
);
insert into teacher values (null, 'ç‹äº”', 'ç”·');
insert into teacher values (null, 'èµµå…­', 'å¥³');
insert into teacher values (null, 'å‘¨ä¸ƒ', 'ç”·');

create table rel(
    stuId int,
    teacherId int
);
insert into rel values (1, 1);
insert into rel values (1, 2);
insert into rel values (1, 3);
insert into rel values (2, 1);
insert into rel values (2, 2);
insert into rel values (2, 3);

insert into rel values (3, 1);#æŠ¥é”™
insert into rel values (1, 4);#æŠ¥é”™

alter table rel add foreign key(stuId) references stu(id);
alter table rel add foreign key(teacherId) references teacher(id);
```





## ç¬¬ 7 ç« : é«˜çº§æŸ¥è¯¢

### 7.1 å•è¡¨æŸ¥è¯¢

```sql
select * from è¡¨å; #æŸ¥è¯¢è¡¨ä¸­æ‰€æœ‰æ•°æ®
select å­—æ®µ1, å­—æ®µ2 from è¡¨å; #æŸ¥è¯¢è¡¨ä¸­æŒ‡å®šå­—æ®µæ•°æ®
select [* || å­—æ®µ] from è¡¨å [where æ¡ä»¶]; #æŸ¥è¯¢è¡¨ä¸­æ»¡è¶³æ¡ä»¶çš„æ•°æ®
```

#### åŸºæœ¬æ¦‚å¿µ

##### ä»€ä¹ˆæ˜¯ç»“æœé›†

é€šè¿‡æŸ¥è¯¢è¯­å¥æŸ¥è¯¢å‡ºæ¥çš„ç»“æœæˆ‘ä»¬å°±ç§°ä¹‹ä¸ºç»“æœé›† ; ç»“æœé›†ä»¥è¡¨çš„å½¢å¼å°†æŸ¥è¯¢çš„ç»“æœè¿”å›ç»™æˆ‘ä»¬

æ³¨æ„ç‚¹:

- ç»“æœé›†è¿”å›çš„è¡¨å’ŒæŸ¥è¯¢çš„è¡¨ä¸æ˜¯åŒä¸€å¼ è¡¨
- è¢«æŸ¥è¯¢çš„è¡¨æ˜¯çœŸå®å­˜åœ¨çš„, æ˜¯å­˜å‚¨åœ¨ç£ç›˜ä¸Šçš„
- è€Œç»“æœé›†ä¸æ˜¯çœŸå®å­˜åœ¨çš„, æ˜¯å­˜å‚¨åˆ°å†…å­˜ä¸­çš„

##### å¦‚ä½•ç»™ç»“æœé›†çš„å­—æ®µåˆ«å

æŸ¥è¯¢æŒ‡å®šå­—æ®µæ•°æ®æ—¶, æˆ‘ä»¬å¯ä»¥é€šè¿‡asç»™æŒ‡å®šå­—æ®µå–åˆ«å

`SELECT name as MyName, age as MyAge FROM stu;`

##### ä»€ä¹ˆæ˜¯å­—æ®µè¡¨è¾¾å¼

æŸ¥è¯¢æ•°æ®çš„æ—¶å€™, é™¤äº†å¯ä»¥æŸ¥è¯¢æŒ‡å®šå­—æ®µçš„æ•°æ®ä»¥å¤–, æˆ‘ä»¬è¿˜å¯ä»¥æŸ¥è¯¢è¡¨è¾¾å¼çš„ç»“æœ

`SELECT 6+6;`

##### ä»€ä¹ˆæ˜¯ä¼ªè¡¨

- å­—æ®µè¡¨è¾¾å¼è™½ç„¶èƒ½å¤ŸæŸ¥è¯¢å‡ºè¡¨è¾¾å¼çš„ç»“æœ, ä½†æ˜¯ä¸ç¬¦åˆMySQLçš„è§„èŒƒ
- æ‰€ä»¥æˆ‘ä»¬å¯ä»¥é€šè¿‡ä¼ªè¡¨(dual)çš„æ–¹å¼è®©å­—æ®µè¡¨è¾¾å¼ç¬¦åˆMySQLçš„è§„èŒƒ

`SELECT 6+6 from dual;`

#### æ¨¡ç³ŠæŸ¥è¯¢



#### æ’åº order by



#### å‡½æ•°

##### èšåˆå‡½æ•°

`count(); ç»Ÿè®¡`

```sql
select count(*) from stu;
select count(*) from stu where score >= 60;
```

`sum(); æ±‚å’Œ`
```sql
select sum(id) from stu;
```

`avg(); æ±‚å¹³å‡å€¼`
```sql
select avg(id) from stu; # 21 / 6 = 3.5
select avg(score) from stu;
```

`max(); è·å–æœ€å¤§å€¼`
```sql
select max(score) from stu;
```

`min(); è·å–æœ€å°å€¼`
```sql
select min(score) from stu;
```



##### æ•°å€¼ç±»å‡½æ•°

`rand()`; ç”Ÿæˆéšæœºæ•°

```sql
select rand() from dual;
select * from stu order by rand();
```

`round()`å››èˆäº”å…¥

```sql
select round(3.1) from dual;
select round(3.5) from dual;
```

`ceil()`; å‘ä¸Šå–æ•´

```sql
select ceil(3.1) from dual;
```

`floor()`; å‘ä¸‹å–æ•´

```sql
select floor(3.9) from dual;
```

`truncate()`; æˆªå–å°æ•°ä½

```sql
select truncate(3.1234567, 2) from dual;
```



##### å­—ç¬¦ä¸²ç±»å‡½æ•°

`ucase(); è½¬æ¢ä¸ºå¤§å†™`

```sql
select ucase('hello world') from dual;
```

`lcase(); è½¬æ¢ä¸ºå°å†™`
```sql
select lcase('HELLO WORLD') from dual;
```

`left(); ä»å·¦è¾¹å¼€å§‹æˆªå–åˆ°æŒ‡å®šçš„ä½ç½®`
```sql
select left('1234567890', 3) from dual;
```

`right(); ä»å³è¾¹å¼€å§‹æˆªå–åˆ°æŒ‡å®šçš„ä½ç½®`
```sql
select right('1234567890', 3) from dual;
```

`substring(); ä»æŒ‡å®šä½ç½®å¼€å§‹æˆªå–æŒ‡å®šä¸ªå­—ç¬¦`
```sql
select substring('1234567890', 3, 5) from dual;
```



#### æ•°æ®åˆ†ç»„ group by

`select åˆ†ç»„å­—æ®µ || èšåˆå‡½æ•° from è¡¨å group by åˆ†ç»„å­—æ®µ;`

éœ€æ±‚: è¦æ±‚ç»Ÿè®¡è¡¨ä¸­ä¸€å…±æœ‰å¤šå°‘ä¸ªåŸå¸‚

```sql
select city from stu;
select city from stu group by city;
```

éœ€æ±‚: è¦æ±‚ç»Ÿè®¡æ¯ä¸ªåŸå¸‚ä¸­æœ‰å¤šå°‘ä¸ªäºº

```sql
select city, count(*) from stu group by city;
```

æ³¨æ„ç‚¹: åœ¨å¯¹æ•°æ®è¿›è¡Œåˆ†ç»„çš„æ—¶å€™, select åé¢å¿…é¡»æ˜¯åˆ†ç»„å­—æ®µæˆ–è€…èšåˆå‡½æ•°, å¦åˆ™å°±åªä¼šè¿”å›ç¬¬ä¸€æ¡æ•°æ®

```sql
select city from stu group by city;
select name from stu group by city;
select city, group_concat(name) from stu group by city;
```



#### æ¡ä»¶æŸ¥è¯¢ having

- havingå’Œwhereå¾ˆåƒéƒ½æ˜¯ç”¨æ¥åšæ¡ä»¶æŸ¥è¯¢çš„
- ä½†æ˜¯whereæ˜¯å»æ•°æ®åº“ä¸­æŸ¥è¯¢ç¬¦åˆæ¡ä»¶çš„æ•°æ®, è€Œhavingæ˜¯å»ç»“æœé›†ä¸­æŸ¥è¯¢ç¬¦åˆæ¡ä»¶çš„æ•°æ®

```sql
select * from stu where city='åŒ—äº¬';
select * from stu having city='åŒ—äº¬';

select name, age from stu where city='åŒ—äº¬';
select name, age from stu having city='åŒ—äº¬';
#Unknown column 'city' in 'having clause'

éœ€æ±‚: select city from stu group by city;
éœ€æ±‚: select city, avg(score) from stu group by city;
éœ€æ±‚: select city, avg(score) as average from stu group by city;
éœ€æ±‚: select city, avg(score) as average from stu group by city having average>=60;
```



#### åˆ†é¡µ limit

`select å­—æ®µ from è¡¨ limit ç´¢å¼•, ä¸ªæ•°;`

```sql
select * from stu limit 0, 3;
select * from stu limit 3, 3;
```



#### æŸ¥è¯¢é€‰é¡¹

```
select [æŸ¥è¯¢é€‰é¡¹] å­—æ®µåç§° from è¡¨å;
all:      æ˜¾ç¤ºæ‰€æœ‰æŸ¥è¯¢å‡ºæ¥çš„æ•°æ®[é»˜è®¤]
distinct: å»é™¤ç»“æœé›†ä¸­é‡å¤çš„æ•°æ®ä¹‹åå†æ˜¾ç¤º
```

```sql
select name from stu;
select all name from stu;
select distinct name from stu;
```

æ³¨æ„ç‚¹:å¦‚æœæ˜¯é€šè¿‡distinctæ¥å¯¹ç»“æœé›†ä¸­é‡å¤çš„æ•°æ®è¿›è¡Œå»é‡;é‚£ä¹ˆåªæœ‰æ‰€æœ‰åˆ—çš„æ•°æ®éƒ½ç›¸åŒæ‰ä¼šå»é‡

```sql
select name, score from stu;
select distinct name, score from stu;
```



#### å®Œæ•´çš„æŸ¥è¯¢è¯­å¥

```sql
select [æŸ¥è¯¢é€‰é¡¹] å­—æ®µåç§° [from è¡¨å] 
[where æ¡ä»¶] 
[order by æ’åº] 
[group by åˆ†ç»„] 
[having æ¡ä»¶] 
[limit åˆ†é¡µ];
```



### 7.2 å¤šè¡¨æŸ¥è¯¢

åˆ›å»ºä¸¤ä¸ªè¡¨`stu` å’Œ `gradle`,å¹¶æ’å…¥æ•°æ®

```sql
CREATE TABLE stu(
	id INT,
	name text
);
INSERT INTO `stu`(`id`, `name`) VALUES (1, 'zs');
INSERT INTO `stu`(`id`, `name`) VALUES (2, 'ls');
INSERT INTO `stu`(`id`, `name`) VALUES (3, 'ww');

CREATE TABLE grade(
	id INT,
	score INT,
	stuId INT
);
INSERT INTO `grade`(`id`, `score`, `stuId`) VALUES (1, 100, 3);
INSERT INTO `grade`(`id`, `score`, `stuId`) VALUES (2, 99, 2);
INSERT INTO `grade`(`id`, `score`, `stuId`) VALUES (3, 88, 1);

CREATE TABLE person(
	id INT,
	name text
);
INSERT INTO `stu`(`id`, `name`) VALUES (1, 'zs');
INSERT INTO `stu`(`id`, `name`) VALUES (2, 'ls');
INSERT INTO `stu`(`id`, `name`) VALUES (3, 'ww');
```

å¤šè¡¨æŸ¥è¯¢åªéœ€è¦åœ¨å•è¡¨æŸ¥è¯¢åŸºç¡€ä¸Šå¢åŠ ä¸€å¼ è¡¨å³å¯ `select * from è¡¨å1, è¡¨å2;`

```sql
select * from stu, grade;
```

æ³¨æ„ç‚¹: é»˜è®¤æƒ…å†µä¸‹å¤šè¡¨æŸ¥è¯¢çš„ç»“æœæ˜¯ç¬›å¡å°”é›†

ç¬›å¡å°”é›†: è¡¨Açš„æ¯ä¸€åˆ—çš„æ•°æ®ä¾æ¬¡å’Œè¡¨Bçš„æ•°æ®ç»„åˆ

![image-20210114144726588](assets/image-20210114144726588.png)

#### åˆçºµæŸ¥è¯¢ union

åœ¨<span style="color:red">çºµå‘</span>ä¸Šå°†å¤šå¼ è¡¨çš„ç»“æœç»“åˆèµ·æ¥è¿”å›ç»™æˆ‘ä»¬ `select * from è¡¨å1 union select * from è¡¨å2;`

```sql
select id, name from stu union select id, score from grade;
```

æ³¨æ„ç‚¹:

- ä½¿ç”¨unionè¿›è¡Œå¤šè¡¨æŸ¥è¯¢, è¿”å›çš„ç»“æœé›†çš„è¡¨å¤´çš„åç§°æ˜¯ç¬¬ä¸€å¼ è¡¨çš„åç§°;ä¾‹å¦‚ä¸Šé¢çš„æŸ¥è¯­å¥,è¿”å›çš„ç»“æœé›†è¡¨å¤´æ˜¯`id,name`è€Œä¸æ˜¯`id,score`

- ä½¿ç”¨unionè¿›è¡Œå¤šè¡¨æŸ¥è¯¢, å¿…é¡»ä¿è¯å¤šå¼ è¡¨æŸ¥è¯¢çš„å­—æ®µä¸ªæ•°ä¸€è‡´;å¦‚æœä¸ä¿è¯è¡¨çš„å­—æ®µä¸ªæ•°ä¸ä¸€è‡´ä¼šæŠ¥é”™

  ```sql
  select id, name from stu union select id, score, stuId from grade;
  -- The used SELECT statements have a different number of columns
  ```

- ä½¿ç”¨unionè¿›è¡Œå¤šè¡¨æŸ¥è¯¢, é»˜è®¤æƒ…å†µä¸‹ä¼šè‡ªåŠ¨å»é‡

  ```sql
  select id, name from stu union select id, name from person;
  ```

- ä½¿ç”¨unionè¿›è¡Œå¤šè¡¨æŸ¥è¯¢, å¦‚æœä¸æƒ³è‡ªåŠ¨å»é‡, é‚£ä¹ˆå¯ä»¥åœ¨unionåé¢åŠ ä¸Šall

  ```sql
  select id, name from stu union all select id, name from person;
  ```



#### è¿æ¥æŸ¥è¯¢ join

- å°†å¤šå¼ è¡¨ä¸­'å…³è”çš„å­—æ®µ''è¿æ¥'åœ¨ä¸€èµ·æŸ¥è¯¢æˆ‘ä»¬ç§°ä¹‹ä¸º'è¡¨çš„è¿æ¥æŸ¥è¯¢'

- å¤§ç™½è¯: æŸ¥è¯¢å¤šå¼ è¡¨ä¸­æ»¡è¶³æ¡ä»¶çš„æ•°æ®

- è¡¨çš„è¿æ¥åˆ†ä¸º: å†…è¿æ¥,å¤–è¿æ¥,äº¤å‰è¿æ¥,å…¨è¿æ¥

  

##### å†…è¿æ¥ inner join

`select * from è¡¨å1 inner join è¡¨å2 on æ¡ä»¶;`

```sql
select * from stu, grade where stu.id = grade.stuId;
select * from stu inner join grade on stu.id = grade.stuId;
```

æ³¨æ„ç‚¹:

- åœ¨è¿›è¡Œå¤šè¡¨æŸ¥è¯¢çš„æ—¶å€™, å¦‚æœæƒ³æŸ¥è¯¢æŒ‡å®šçš„å­—æ®µ, é‚£ä¹ˆå¿…é¡»åœ¨å­—æ®µåç§°å‰é¢åŠ ä¸Šè¡¨åæ‰è¡Œ

  ```sql
  select stu.id, stu.name, grade.score from stu inner join grade on stu.id = grade.stuId;
  ```

- åœ¨å†…è¿æ¥ä¸­åªä¼šè¿”å›æ»¡è¶³æ¡ä»¶çš„æ•°æ®



##### å¤–è¿æ¥

###### å·¦å¤–è¿æ¥ left join

- åœ¨å·¦å¤–è¿æ¥ä¸­, å·¦è¾¹çš„è¡¨æ˜¯ä¸çœ‹æ¡ä»¶çš„, æ— è®ºæ¡ä»¶æ˜¯å¦æ»¡è¶³, éƒ½ä¼šè¿”å›å·¦è¾¹è¡¨ä¸­æ‰€æœ‰çš„æ•°æ®
- åœ¨å·¦å¤–è¿æ¥ä¸­, åªæœ‰å³è¾¹çš„è¡¨ä¼šçœ‹æ¡ä»¶, å¯¹äºå³è¾¹çš„è¡¨è€Œè¨€, åªæœ‰æ»¡è¶³æ¡ä»¶æ‰ä¼šè¿”å›å¯¹åº”çš„æ•°æ®

```sql
select stu.id, stu.name, grade.score from stu left join grade on stu.id = grade.stuId;
-- åœ¨ä»¥ä¸Šçš„æŸ¥è¯¢è¯­å¥ä¸­stuè¡¨åœ¨å·¦è¾¹, gradeè¡¨åœ¨å³è¾¹
-- æ‰€ä»¥stuè¡¨ä¸çœ‹æ¡ä»¶, åªæœ‰gradeè¡¨çœ‹æ¡ä»¶
```



###### å³å¤–è¿æ¥ right join

- åœ¨å³å¤–è¿æ¥ä¸­, å³è¾¹çš„è¡¨æ˜¯ä¸çœ‹æ¡ä»¶çš„, æ— è®ºæ¡ä»¶æ˜¯å¦æ»¡è¶³, éƒ½ä¼šè¿”å›å³è¾¹è¡¨ä¸­æ‰€æœ‰çš„æ•°æ®
- åœ¨å³å¤–è¿æ¥ä¸­, åªæœ‰å·¦è¾¹çš„è¡¨ä¼šçœ‹æ¡ä»¶, å¯¹äºå·¦è¾¹çš„è¡¨è€Œè¨€, åªæœ‰æ»¡è¶³æ¡ä»¶æ‰ä¼šè¿”å›å¯¹åº”çš„æ•°æ®

```sql
select stu.id, stu.name, grade.score from stu right join grade on stu.id = grade.stuId;
-- åœ¨ä»¥ä¸Šçš„æŸ¥è¯¢è¯­å¥ä¸­stuè¡¨åœ¨å·¦è¾¹, gradeè¡¨åœ¨å³è¾¹
-- æ‰€ä»¥gradeè¡¨ä¸çœ‹æ¡ä»¶, åªæœ‰stuè¡¨çœ‹æ¡ä»¶
```



##### äº¤å‰è¿æ¥ cross join

å¦‚æœæ²¡æœ‰æŒ‡å®šæ¡ä»¶, é‚£ä¹ˆè¿”å›ç¬›å¡å°”é›†

```sql
select stu.id, stu.name, grade.score from stu cross join grade;
```

å¦‚æœæŒ‡å®šäº†æ¡ä»¶, é‚£ä¹ˆå°±ç­‰ä»·äºå†…è¿æ¥

```sql
select stu.id, stu.name, grade.score from stu cross join grade on stu.id = grade.stuId;
```

##### å…¨è¿æ¥ full join

MySQLä¸æ”¯æŒå…¨è¿æ¥

#### è‡ªç„¶è¿æ¥(natural)

è‡ªç„¶è¿æ¥æ˜¯ç”¨æ¥ç®€åŒ–'å†…è¿æ¥å’Œå¤–è¿æ¥'çš„

å¦‚æœå¤šå¼ è¡¨éœ€è¦åˆ¤æ–­çš„æ¡ä»¶å­—æ®µåç§°ä¸€è‡´, é‚£ä¹ˆä¸ç”¨ç¼–å†™æ¡ä»¶, è‡ªç„¶è¿æ¥ä¼šè‡ªåŠ¨åˆ¤æ–­

##### è‡ªç„¶å†…è¿æ¥

`select * from è¡¨å1 inner join è¡¨å2 on æ¡ä»¶;`

```sql
select * from stu inner join grade on stu.id = grade.stuId;
```

`select * from è¡¨å1 natural join è¡¨å2;`

```sql
select * from stu natural join grade;
```

##### è‡ªç„¶å¤–è¿æ¥

###### è‡ªç„¶å·¦å¤–è¿æ¥

```sql
select * from stu natural left join grade;
```

###### è‡ªç„¶å³å¤–è¿æ¥

```sql
select * from stu natural right join grade;
```

æ³¨æ„ç‚¹:

- å¦‚æœæ²¡æœ‰æŒ‡å®šæ¡ä»¶, ä¹Ÿæ²¡æœ‰åŒåçš„å­—æ®µ, é‚£ä¹ˆå°±ä¼šè¿”å›ç¬›å¡å°”é›†
- åœ¨è‡ªç„¶è¿æ¥ä¸­, è¿”å›çš„ç»“æœé›†ä¼šè‡ªåŠ¨ä¼˜åŒ–, ä¼šè‡ªåŠ¨å»é™¤é‡å¤çš„åˆ¤æ–­å­—æ®µ



#### usingå…³é”®å­—

å¦‚æœå¤šå¼ è¡¨éœ€è¦åˆ¤æ–­çš„æ¡ä»¶å­—æ®µåç§°ä¸€è‡´, é‚£ä¹ˆé™¤äº†å¯ä»¥ä½¿ç”¨è‡ªç„¶è¿æ¥æ¥ç®€åŒ–ä»¥å¤–è¿˜å¯ä»¥ä½¿ç”¨usingå…³é”®å­—æ¥ç®€åŒ–

##### ç®€åŒ–å†…è¿æ¥

```sql
select * from stu inner join grade on stu.stuId = grade.stuId;
select * from stu inner join grade using(stuId);
```

##### ç®€åŒ–å¤–è¿æ¥

###### å·¦å¤–è¿æ¥

```sql
select * from stu left join grade on stu.stuId = grade.stuId;
select * from stu left join grade using(stuId);
```

###### å³å¤–è¿æ¥

```sql
select * from stu right join grade on stu.stuId = grade.stuId;
select * from stu right join grade using(stuId);
```

#### å­æŸ¥è¯¢

- å°†ä¸€ä¸ªæŸ¥è¯¢è¯­å¥æŸ¥è¯¢çš„ç»“æœä½œä¸ºå¦ä¸€ä¸ªæŸ¥è¯¢è¯­å¥çš„æ¡ä»¶æ¥ä½¿ç”¨
- å°†ä¸€ä¸ªæŸ¥è¯¢è¯­å¥æŸ¥è¯¢çš„ç»“æœä½œä¸ºå¦ä¸€ä¸ªæŸ¥è¯¢è¯­å¥çš„è¡¨æ¥ä½¿ç”¨

##### ç»“æœä½œä¸ºæ¡ä»¶

###### æ ‡å‡†å­æŸ¥è¯¢(è¿”å›çš„ç»“æœåªæœ‰ä¸€ä¸ª)

```sql
select stuId from grade where score = 100;
select name from stu where stuId = 3;

select name from stu where stuId = (select stuId from grade where score = 100);
```

###### éæ ‡å‡†å­æŸ¥è¯¢(è¿”å›çš„ç»“æœæœ‰å¤šä¸ª)

```sql
select stuId from grade where score >= 60;
select name from stu where stuId = 3 OR stuId = 1;
select name from stu where stuId in(3, 1);

select name from stu where stuId in(select stuId from grade where score >= 60);
```



##### ç»“æœä½œä¸ºè¡¨

```sql
select name, city, score from person where score >= 60;
select name, city, score from (select name, city, score from person where score >= 60) as t;
```

æ³¨æ„ç‚¹: å¦‚æœè¦å°†ä¸€ä¸ªæŸ¥è¯¢è¯­å¥æŸ¥è¯¢çš„ç»“æœä½œä¸ºå¦ä¸€ä¸ªæŸ¥è¯¢çš„è¡¨æ¥ä½¿ç”¨, é‚£ä¹ˆå¿…é¡»ç»™å­æŸ¥è¯¢èµ·ä¸€ä¸ªåˆ«å

## ç¬¬ 8 ç« : äº‹åŠ¡ 

### 8.1 äº‹åŠ¡åŸºæœ¬æ¦‚å¿µ

- MySQLä¸­çš„äº‹åŠ¡ä¸»è¦ç”¨äºå¤„ç†å®¹æ˜“å‡ºé”™çš„æ•°æ®ã€‚
- äº‹åŠ¡å¯ä»¥ç”¨æ¥ç»´æŠ¤æ•°æ®åº“çš„å®Œæ•´æ€§ï¼Œä¿è¯æˆæ‰¹çš„ SQL è¯­å¥è¦ä¹ˆå…¨éƒ¨æ‰§è¡Œï¼Œè¦ä¹ˆå…¨éƒ¨ä¸æ‰§è¡Œã€‚
- äº‹åŠ¡ç”¨æ¥ç®¡ç† insert,update,delete è¯­å¥
- MySQLä¸­åªæœ‰ä½¿ç”¨äº† Innodb æ•°æ®åº“å¼•æ“çš„è¡¨æ‰æ”¯æŒäº‹åŠ¡ã€‚

### 8.2 äº‹ç‰©è¯­æ³•

```
å¼€å¯äº‹åŠ¡: start transaction
æäº¤äº‹åŠ¡: commit
å›æ»šäº‹åŠ¡: rollback
```

**ç¤ºä¾‹ä¸€:**

```sql
create table bank(
    id  int unsigned auto_increment primary key,
    cardid varchar(4),
    name   varchar(20),
    money int
);
insert into bank values (null, '1001', 'zs', 1000), (null, '1002', 'ls', 1000);
-- ç¬¬ä¸€ç§: å…ˆæ‰£å†å¢åŠ 
update bank set money=money-1000 where cardid='1002';
update bank set money=money+1000 where cardid='1001';
-- ç¬¬äºŒç§: å…ˆå¢åŠ å†æ‰£
update bank set money=money+1000 where cardid='1001';
update bank set money=money-1000 where cardid='1002';

start transaction; -- å¼€å¯äº‹åŠ¡
update bank set money=money-1000 where cardid='1002';
rollback; -- ä»»åŠ¡å¤±è´¥, å›æ»šåˆ°å¼€å¯ä¹‹å‰çŠ¶æ€
update bank set money=money+1000 where cardid='1001';
commit; -- ä»»åŠ¡æˆåŠŸ, æäº¤å¼€å¯äº‹åŠ¡ä¹‹åæ‰€æœ‰æ“ä½œ
```

æ³¨æ„ç‚¹:

- äº‹åŠ¡çš„æœ¬è´¨æ˜¯å¼€å¯äº‹åŠ¡çš„æ—¶å€™æ‹·è´ä¸€å¼ ä¸€æ¨¡ä¸€æ ·çš„è¡¨
- ç„¶åæ‰§è¡Œç›¸å…³çš„æ“ä½œéƒ½æ˜¯åœ¨æ‹·è´çš„è¿™å¼ è¡¨ä¸­åšæ“ä½œ
- å¦‚æœå¤±è´¥äº†, å¦‚æœæ‰§è¡Œäº†rollback, é‚£ä¹ˆç³»ç»Ÿå°±ä¼šè‡ªåŠ¨åˆ é™¤æ‹·è´çš„è¿™å¼ è¡¨
- æ‰€ä»¥å¤±è´¥äº†ä¸ä¼šå½±å“åˆ°åŸæœ‰çš„æ•°æ®
- å¦‚æœæˆåŠŸäº†, å¦‚æœæ‰§è¡Œäº†commit, é‚£ä¹ˆç³»ç»Ÿå°±ä¼šè‡ªåŠ¨åˆ©ç”¨æ‹·è´è¡¨ä¸­æœ€æ–°çš„æ•°æ®è¦†ç›–åŸæœ‰è¡¨ä¸­çš„æ•°æ®
- æ‰€ä»¥æˆåŠŸäº†ä¼šå½±å“åˆ°åŸæœ‰çš„æ•°æ®





### 8.3 äº‹åŠ¡å›æ»šç‚¹

```
savepoint å›æ»šç‚¹åç§°
rollback to å›æ»šç‚¹åç§°
```

```sql
start transaction;
insert into bank values (null, '1003', '333', 33333);
savepoint abc;
insert into bank values (null, '1003', '444', 44444);
savepoint def;
insert into bank values (null, '1003', '555', 55555);
rollback to abc;
```



### 8.4 äº‹åŠ¡ç‰¹ç‚¹

**åŸå­æ€§(å…³æ³¨çš„æ˜¯çŠ¶æ€)ï¼š**

- äº‹åŠ¡å¼€å¯åçš„æ‰€æœ‰æ“ä½œï¼Œè¦ä¹ˆå…¨éƒ¨æˆåŠŸï¼Œè¦ä¹ˆå…¨éƒ¨å¤±è´¥ï¼Œä¸å¯èƒ½å‡ºç°éƒ¨åˆ†æˆåŠŸçš„æƒ…å†µ
- äº‹åŠ¡æ‰§è¡Œè¿‡ç¨‹ä¸­å¦‚æœå‡ºé”™ï¼Œå“ªæ€•æˆ‘ä»¬ä¸æ‰‹åŠ¨å›æ»š, ç³»ç»Ÿä¹Ÿä¼šè‡ªåŠ¨å¸®æˆ‘ä»¬å›æ»š

**ä¸€è‡´æ€§(å…³æ³¨æ•°æ®å¯è§æ€§)ï¼š**

- äº‹åŠ¡å¼€å§‹å‰å’Œç»“æŸåï¼Œæ•°æ®åº“çš„å®Œæ•´æ€§çº¦æŸæ²¡æœ‰è¢«ç ´å
- ä¾‹å¦‚ Aå‘Bè½¬è´¦ï¼Œä¸å¯èƒ½Aæ‰£äº†é’±ï¼ŒBå´æ²¡æ”¶åˆ°

**æŒä¹…æ€§ï¼š**

- äº‹åŠ¡å®Œæˆåï¼Œäº‹åŠ¡å¯¹æ•°æ®åº“çš„æ‰€æœ‰æ“ä½œæ˜¯æ°¸ä¹…çš„, æ“ä½œå®Œæˆä¹‹åå°±ä¸èƒ½å†å›æ»š

**éš”ç¦»æ€§ï¼š**

- æ•°æ®åº“å…è®¸å¤šä¸ªå¹¶å‘äº‹åŠ¡åŒæ—¶å¯¹å…¶æ•°æ®è¿›è¡Œè¯»å†™å’Œä¿®æ”¹çš„èƒ½åŠ›ï¼Œ
- éš”ç¦»æ€§å¯ä»¥é˜²æ­¢å¤šä¸ªäº‹åŠ¡å¹¶å‘æ—¶ç”±äºäº¤å‰æ‰§è¡Œè€Œå¯¼è‡´æ•°æ®çš„ä¸ä¸€è‡´ã€‚

### 8.5 äº‹åŠ¡éš”ç¦»çº§åˆ«

#### 4ç§éš”ç¦»çº§åˆ«

- è¯»æœªæäº¤ï¼ˆread uncommittedï¼‰: ä¸€ä¸ªäº‹åŠ¡å¯ä»¥è¯»å–å¦ä¸€ä¸ªæœªæäº¤äº‹åŠ¡çš„æ•°æ®
- è¯»æäº¤ï¼ˆread committedï¼‰: ä¸€ä¸ªäº‹åŠ¡è¦ç­‰å¦ä¸€ä¸ªäº‹åŠ¡æäº¤åæ‰èƒ½è¯»å–æ•°æ®
- å¯é‡å¤è¯»ï¼ˆrepeatable readï¼‰: ä¸€ä¸ªäº‹åŠ¡èŒƒå›´å†…å¤šä¸ªç›¸åŒçš„æŸ¥è¯¢è¿”å›ç›¸åŒçš„ç»“æœ
- ä¸²è¡ŒåŒ–ï¼ˆserializableï¼‰: å‰é¢ä¸€ä¸ªäº‹åŠ¡æ²¡æœ‰æ‰§è¡Œå®Œåé¢ä¸€ä¸ªäº‹åŠ¡ä¸èƒ½æ‰§è¡Œ

#### æŸ¥çœ‹éš”ç¦»çº§åˆ«

- å…¨å±€çš„: `select @@global.transaction_isolation;`
- å½“å‰ä¼šè¯çš„: `select @@transaction_isolation;`

#### è®¾ç½®éš”ç¦»çº§åˆ«

- å…¨å±€çš„: `set global transaction isolation level çº§åˆ«åç§°;`
- å½“å‰ä¼šè¯: `set session transaction isolation level çº§åˆ«åç§°;`

#### 4ç§ç»“æœ

##### è„è¯»

èƒ½è¯»å–åˆ°å…¶å®ƒäº‹åŠ¡æ²¡æœ‰æäº¤çš„æ•°æ®

```sql
-- Aå®¢æˆ·ç«¯:
set session transaction isolation level read uncommitted;
start transaction;
update bank set money=money-1000 where cardId='1002';
select * from bank;
-- Bå®¢æˆ·ç«¯:
set session transaction isolation level read uncommitted;
select * from bank;

-- è§£å†³åŠæ³•(read committed)
--Aå®¢æˆ·ç«¯:
set session transaction isolation level read committed;
start transaction;
update bank set money=money-1000 where cardId='1002';
select * from bank;
-- Bå®¢æˆ·ç«¯:
set session transaction isolation level read committed;
select * from bank;
```





##### ä¸å¯é‡å¤è¯»

ä¸€ä¸ªäº‹åŠ¡èŒƒå›´å†…å¤šæ¬¡æŸ¥è¯¢çš„ç»“æœä¸åŒ

```sql
-- Aå®¢æˆ·ç«¯:
set session transaction isolation level read committed;
start transaction;
select * from bank;
-- Bå®¢æˆ·ç«¯:
set session transaction isolation level read committed;
start transaction;
update bank set money=money-1000 where cardId='1002';
commit;
-- Aå®¢æˆ·ç«¯:
select * from bank;
commit;
-- è§£å†³åŠæ³•(repeatable read)
```





##### é‡å¤è¯»

ä¸€ä¸ªäº‹åŠ¡èŒƒå›´å†…å¤šæ¬¡æŸ¥è¯¢çš„ç»“æœç›¸åŒ

```sql
-- Aå®¢æˆ·ç«¯:
set session transaction isolation level repeatable read;
start transaction;
select * from bank;
-- Bå®¢æˆ·ç«¯:
set session transaction isolation level repeatable read;
start transaction;
update bank set money=money-1000 where cardid='1002';
commit;
-- Aå®¢æˆ·ç«¯:
select * from bank;
commit;
-- è§£å†³åŠæ³•(serializable)
```



##### å¹»è¯»

è¯»åˆ°åˆ°çš„ç»“æœå¹¶ä¸æ˜¯æœ€ç»ˆçš„ç»“æœ

```sql
-- Aå®¢æˆ·ç«¯:
set session transaction isolation level serializable;
start transaction;
select * from bank;
-- Bå®¢æˆ·ç«¯:
set session transaction isolation level serializable;
start transaction;
update bank set money=money-1000 where cardid='1002';
commit;
-- Aå®¢æˆ·ç«¯:
select * from bank;
commit;
```



#### 4ç§ç»“æœä¸4ç§éš”ç¦»çº§åˆ«çš„å¯¹åº”å…³ç³»

| äº‹åŠ¡éš”ç¦»çº§åˆ«                 | è„è¯» | ä¸å¯é‡å¤è¯» | å¹»è¯» |
| ---------------------------- | ---- | ---------- | ---- |
| è¯»æœªæäº¤ï¼ˆread-uncommittedï¼‰ | æ˜¯   | æ˜¯         | æ˜¯   |
| ä¸å¯é‡å¤è¯»ï¼ˆread-committedï¼‰ | å¦   | æ˜¯         | æ˜¯   |
| å¯é‡å¤è¯»ï¼ˆrepeatable-readï¼‰  | å¦   | å¦         | æ˜¯   |
| ä¸²è¡ŒåŒ–ï¼ˆserializableï¼‰       | å¦   | å¦         | å¦   |



## ç¬¬ 9 ç« : è§†å›¾ ğŸš©

9.1 è§†å›¾åŸºæœ¬æ¦‚å¿µ



9.2 è§†å›¾çš„ä½œç”¨



9.3 åˆ›å»ºè§†å›¾è¯­æ³•



9.4 è§†å›¾æ•°æ®æ“ä½œ



9.5 ä¿®æ”¹è§†å›¾å†…å®¹



9.6 åˆ é™¤è§†å›¾



9.7 è§†å›¾å®Œæ•´è¯­å¥



9.8 è§†å›¾ç®—æ³•



9.9 è§†å›¾é™åˆ¶(with check option)



9.10 é¢„å¤„ç†



## ç¬¬ 10 ç« : å­˜å‚¨è¿‡ç¨‹å’Œå‡½æ•°



## ç¬¬ 11 ç« : ç´¢å¼•



## ç¬¬ 12 ç« : NodeJSæ“ä½œMySQL

 